import{r as p,h as v,g as q,w as N,b as e,a as F,e as r,d as L,j as u,c as n,f as M,o as i,F as _,m as f,t as a,q as C,p as B,n as $,v as E,u as O,i as z,N as G}from"./app-9HEqLJnm.js";import{_ as R}from"./AppLayout-DD1QV7aw.js";import{_ as H}from"./CreditoModal-DEBppTZ9.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-DAvYmej3.js";import"./Modal-CRs6EPgD.js";import"./PrimaryButton-CtN6bpro.js";import"./SecondaryButton-D5Y2-mVN.js";const K={class:"container py-4"},Q={class:"row"},W={class:"col-lg-10 mx-auto"},X={class:"card shadow-sm border-0 mb-4"},Y={class:"card-body p-4"},Z={class:"row"},ee={class:"col-md-8"},te=["value"],oe={key:0,class:"mt-2"},se={class:"text-muted"},le={class:"card shadow-sm border-0 mb-4"},ae={class:"card-body p-4"},ie={class:"row mb-4"},ne={class:"col-md-6"},re={class:"table-responsive mb-4",style:{"max-height":"300px","overflow-y":"auto"}},de={class:"table table-hover align-middle"},ce={class:"fw-semibold"},ue={key:0,class:"badge bg-danger"},me={key:1,class:"text-muted"},be={class:"text-center"},pe=["onClick","disabled"],ve={key:0},_e={class:"table-responsive"},fe={class:"table table-bordered table-striped align-middle"},ge={class:"fw-semibold"},ye=["onUpdate:modelValue","max"],he={class:"text-muted"},we={key:0,class:"badge bg-danger"},xe={key:1},Ce={class:"fw-bold text-primary"},ke={class:"text-center"},Pe=["onClick"],Ve={class:"table-light"},Ae={colspan:"2",class:"fw-bold fs-5 text-primary"},Se={key:1,class:"alert alert-info"},Ne={class:"card shadow-sm border-0 mb-4"},Fe={class:"card-body p-4"},Me={class:"row"},Be={class:"col-md-4"},Ue={class:"col-md-4"},je=["value"],De={class:"col-md-4"},Ie={class:"form-check"},Te={key:0,class:"alert alert-warning mt-3"},qe={class:"card shadow-sm border-0"},Le={class:"card-body p-4 text-end"},$e=["disabled"],Ee={__name:"Create",props:{clientes:Array,productos:Array,metodosPago:Array},setup(g){const y=g,l=p({user_id:"",metodo_pago_id:"",tipo_pago:"contado",detalles:[],confirmar_inmediatamente:!1,numero_cuotas:3}),m=p(""),h=p(!1),w=p(!1),k=v(()=>y.clientes.find(s=>s.id===l.value.user_id)||{}),U=v(()=>{if(!m.value)return y.productos;const s=m.value.toLowerCase();return y.productos.filter(t=>t.nombre.toLowerCase().includes(s)||t.codigo&&t.codigo.toLowerCase().includes(s))}),P=v(()=>l.value.detalles.reduce((s,t)=>s+t.subtotal,0)),V=v(()=>l.value.user_id&&l.value.metodo_pago_id&&l.value.detalles.length>0),j=s=>{var d;if(l.value.detalles.find(S=>S.producto_id===s.id))return alert("Este producto ya está agregado");let o=0;(d=s.promociones)!=null&&d.length&&(o=parseFloat(s.promociones[0].valor_descuento_decimal));const c=s.precio_venta*(1-o/100);l.value.detalles.push({producto_id:s.id,nombre:s.nombre,cantidad:1,precio_unitario:parseFloat(s.precio_venta),descuento_porcentaje:o,stock_disponible:s.stock_actual,subtotal:c}),x()},D=s=>{l.value.detalles.splice(s,1),x()},x=()=>{l.value.detalles.forEach(s=>{const t=s.precio_unitario*(1-s.descuento_porcentaje/100);s.subtotal=t*s.cantidad})},b=s=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(s),I=()=>{if(!V.value)return alert("Complete los campos obligatorios");if(l.value.confirmar_inmediatamente&&l.value.tipo_pago==="credito"){w.value=!0;return}A()},T=s=>{l.value.numero_cuotas=s,A()},A=()=>{h.value=!0,G.post(route("pedidos.admin.store"),l.value,{onFinish:()=>h.value=!1})};return(s,t)=>(i(),q(R,{title:"Crear Pedido"},{default:N(()=>[e("div",K,[e("div",Q,[e("div",W,[t[28]||(t[28]=e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e("div",null,[e("h2",{class:"mb-0 text-primary fw-bold"},[e("i",{class:"bi bi-plus-circle me-2"}),r(" Crear Nuevo Pedido ")]),e("p",{class:"text-muted"}," Registra un pedido realizado en tienda física ")])],-1)),e("form",{onSubmit:L(I,["prevent"])},[e("div",X,[e("div",Y,[t[9]||(t[9]=e("h5",{class:"fw-bold mb-3 text-primary"},[e("i",{class:"bi bi-person-lines-fill me-2"}),r(" 1. Seleccionar Cliente ")],-1)),e("div",Z,[e("div",ee,[t[8]||(t[8]=e("label",{class:"form-label fw-semibold"},"Cliente *",-1)),u(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.user_id=o),class:"form-select",required:""},[t[6]||(t[6]=e("option",{value:""},"-- Seleccione un cliente --",-1)),(i(!0),n(_,null,f(g.clientes,o=>(i(),n("option",{key:o.id,value:o.id},a(o.nombre)+" "+a(o.apellidos)+" - CI: "+a(o.ci),9,te))),128))],512),[[C,l.value.user_id]]),l.value.user_id?(i(),n("div",oe,[e("small",se,[t[7]||(t[7]=e("i",{class:"bi bi-info-circle me-1"},null,-1)),r(" "+a(k.value.email)+" | "+a(k.value.telefono),1)])])):M("",!0)])])])]),e("div",le,[e("div",ae,[t[17]||(t[17]=e("h5",{class:"fw-bold mb-4 text-primary"},[e("i",{class:"bi bi-bag-plus me-2"}),r(" 2. Agregar Productos ")],-1)),e("div",ie,[e("div",ne,[u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),type:"text",class:"form-control",placeholder:"Buscar producto por nombre o código..."},null,512),[[B,m.value]])])]),e("div",re,[e("table",de,[t[11]||(t[11]=e("thead",{class:"table-light sticky-top"},[e("tr",null,[e("th",null,"Código"),e("th",null,"Producto"),e("th",null,"Categoría"),e("th",null,"Precio"),e("th",null,"Stock"),e("th",null,"Descuento"),e("th",{class:"text-center"},"Acción")])],-1)),e("tbody",null,[(i(!0),n(_,null,f(U.value,o=>{var c,d;return i(),n("tr",{key:o.id},[e("td",null,a(o.codigo),1),e("td",ce,a(o.nombre),1),e("td",null,a(((c=o.categoria)==null?void 0:c.nombre)||"N/A"),1),e("td",null,a(b(o.precio_venta)),1),e("td",null,[e("span",{class:$(o.stock_actual<10?"badge bg-warning":"badge bg-success")},a(o.stock_actual),3)]),e("td",null,[(d=o.promociones)!=null&&d.length?(i(),n("span",ue," -"+a(o.promociones[0].valor_descuento_decimal)+"% ",1)):(i(),n("span",me,"-"))]),e("td",be,[e("button",{type:"button",class:"btn btn-sm btn-primary",onClick:S=>j(o),disabled:o.stock_actual===0},[...t[10]||(t[10]=[e("i",{class:"bi bi-plus-circle me-1"},null,-1),r(" Agregar ",-1)])],8,pe)])])}),128))])])]),l.value.detalles.length>0?(i(),n("div",ve,[t[15]||(t[15]=e("h5",{class:"fw-bold mb-3 text-primary"},[e("i",{class:"bi bi-box-seam me-2"}),r(" Productos Seleccionados ")],-1)),e("div",_e,[e("table",fe,[t[14]||(t[14]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"Producto"),e("th",{width:"150"},"Cantidad"),e("th",null,"Precio Unit."),e("th",null,"Descuento"),e("th",null,"Subtotal"),e("th",{width:"80"},"Acción")])],-1)),e("tbody",null,[(i(!0),n(_,null,f(l.value.detalles,(o,c)=>(i(),n("tr",{key:o.producto_id},[e("td",ge,a(o.nombre),1),e("td",null,[u(e("input",{"onUpdate:modelValue":d=>o.cantidad=d,type:"number",min:"1",max:o.stock_disponible,class:"form-control form-control-sm",onInput:x},null,40,ye),[[B,o.cantidad,void 0,{number:!0}]]),e("small",he,"Máx: "+a(o.stock_disponible),1)]),e("td",null,a(b(o.precio_unitario)),1),e("td",null,[o.descuento_porcentaje>0?(i(),n("span",we," -"+a(o.descuento_porcentaje)+"% ",1)):(i(),n("span",xe,"-"))]),e("td",Ce,a(b(o.subtotal)),1),e("td",ke,[e("button",{class:"btn btn-sm btn-danger",type:"button",onClick:d=>D(c)},[...t[12]||(t[12]=[e("i",{class:"bi bi-trash"},null,-1)])],8,Pe)])]))),128))]),e("tfoot",Ve,[e("tr",null,[t[13]||(t[13]=e("td",{colspan:"4",class:"text-end fw-bold"},"TOTAL:",-1)),e("td",Ae,a(b(P.value)),1)])])])])])):(i(),n("div",Se,[...t[16]||(t[16]=[e("i",{class:"bi bi-info-circle me-1"},null,-1),r(" No hay productos seleccionados. Agrega al menos 1 producto. ",-1)])]))])]),e("div",Ne,[e("div",Fe,[t[25]||(t[25]=e("h5",{class:"fw-bold mb-4 text-primary"},[e("i",{class:"bi bi-credit-card me-2"}),r(" 3. Método de Pago ")],-1)),e("div",Me,[e("div",Be,[t[19]||(t[19]=e("label",{class:"form-label fw-semibold"},"Tipo de Pago *",-1)),u(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.tipo_pago=o),class:"form-select",required:""},[...t[18]||(t[18]=[e("option",{value:"contado"},"Al Contado",-1),e("option",{value:"credito"},"A Crédito",-1)])],512),[[C,l.value.tipo_pago]])]),e("div",Ue,[t[21]||(t[21]=e("label",{class:"form-label fw-semibold"},"Método de Pago *",-1)),u(e("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.metodo_pago_id=o),class:"form-select",required:""},[t[20]||(t[20]=e("option",{value:""},"-- Seleccione método --",-1)),(i(!0),n(_,null,f(g.metodosPago,o=>(i(),n("option",{key:o.id,value:o.id},a(o.nombre),9,je))),128))],512),[[C,l.value.metodo_pago_id]])]),e("div",De,[t[23]||(t[23]=e("label",{class:"form-label d-block fw-semibold"}," ",-1)),e("div",Ie,[u(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.confirmar_inmediatamente=o),class:"form-check-input",type:"checkbox",id:"confirmarInmediato"},null,512),[[E,l.value.confirmar_inmediatamente]]),t[22]||(t[22]=e("label",{class:"form-check-label",for:"confirmarInmediato"},[e("strong",null,"Confirmar inmediatamente")],-1))])])]),l.value.tipo_pago==="credito"?(i(),n("div",Te,[...t[24]||(t[24]=[e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),e("strong",null,"Pago a Crédito:",-1),r(" Se generará un crédito al confirmar el pedido. ",-1)])])):M("",!0)])]),e("div",qe,[e("div",Le,[F(O(z),{href:s.route("pedidos.index"),class:"btn btn-secondary"},{default:N(()=>[...t[26]||(t[26]=[e("i",{class:"bi bi-arrow-left me-2"},null,-1),r(" Cancelar ",-1)])]),_:1},8,["href"]),e("button",{type:"submit",class:"btn btn-success ms-2",disabled:!V.value||h.value},[t[27]||(t[27]=e("i",{class:"bi bi-save me-2"},null,-1)),r(" "+a(l.value.confirmar_inmediatamente?"Crear y Confirmar Venta":"Crear Pedido"),1)],8,$e)])])],32)])])]),F(H,{show:w.value,total:P.value,"cuotas-iniciales":l.value.numero_cuotas,onClose:t[5]||(t[5]=o=>w.value=!1),onConfirmar:T},null,8,["show","total","cuotas-iniciales"])]),_:1}))}},We=J(Ee,[["__scopeId","data-v-ae593997"]]);export{We as default};
