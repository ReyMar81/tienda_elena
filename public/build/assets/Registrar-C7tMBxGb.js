import{r as v,h as M,g as T,w as D,b as e,c as r,f as u,o as n,j as b,p as f,F as P,m as N,t as a,n as E,e as p,d as I,q as R,a as q,u as L,i as O,K as $,N as z}from"./app-BM_Csk7S.js";import{_ as A}from"./AppLayout-Aol2IiYi.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"container py-4"},G={class:"row justify-content-center"},H={class:"col-lg-8"},J={class:"card"},Q={class:"card-body"},W={key:0,class:"mb-4"},X={key:1,class:"mb-4"},Y={class:"list-group"},Z=["onClick"],ee={class:"text-end"},te={key:0,class:"text-danger small"},oe={key:2,class:"mb-4"},se={class:"alert alert-info"},ae={class:"mb-1"},le={class:"mb-1"},ne={key:0,class:"mb-1"},re={class:"mb-0"},de={class:"mb-3"},ue=["max"],ie={class:"text-muted"},me={key:0,class:"text-danger small mt-1"},ce={class:"mb-3"},ve=["value"],be={key:0,class:"text-danger small mt-1"},pe={class:"mb-3"},ge={class:"mb-3"},fe={class:"mb-3"},_e={class:"d-flex justify-content-between"},ye=["disabled"],xe={key:0,class:"spinner-border spinner-border-sm me-2"},Se={__name:"Registrar",props:{cuota:Object,metodosPago:Array},setup(i){var w;const y=i,_=v(""),x=v([]),d=v(null),g=v(!1),c=v({}),l=v({cuota_id:((w=y.cuota)==null?void 0:w.id)||"",monto:"",metodo_pago_id:"",fecha:new Date().toISOString().split("T")[0],comprobante:"",notas:""}),C=M(()=>{const o=d.value||y.cuota;return(o==null?void 0:o.mora_calculada)||(o==null?void 0:o.mora)||0}),k=M(()=>{const o=d.value||y.cuota;return((o==null?void 0:o.monto_pendiente)||0)+C.value}),h=async()=>{if(_.value)try{const o=await $.get(route("pagos.buscar-cuotas"),{params:{credito_id:_.value}});x.value=o.data}catch(o){console.error("Error buscando cuotas:",o)}},F=o=>{d.value=o,l.value.cuota_id=o.id,l.value.monto=o.total_pagar},U=()=>{g.value=!0,c.value={},z.post(route("pagos.store"),l.value,{onError:o=>{c.value=o,g.value=!1},onFinish:()=>{g.value=!1}})},m=o=>parseFloat(o||0).toFixed(2),j=o=>new Date(o).toLocaleDateString("es-ES");return(o,t)=>(n(),T(A,{title:"Registrar Pago"},{default:D(()=>{var B,S,V;return[e("div",K,[e("div",G,[e("div",H,[e("div",J,[t[21]||(t[21]=e("div",{class:"card-header bg-success text-white"},[e("h4",{class:"mb-0"},"Registrar Pago Manual")],-1)),e("div",Q,[i.cuota?u("",!0):(n(),r("div",W,[t[6]||(t[6]=e("label",{class:"form-label fw-bold"},"Buscar Crédito",-1)),b(e("input",{type:"number",class:"form-control",placeholder:"Ingrese ID del crédito...","onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s),onChange:h},null,544),[[f,_.value]])])),x.value.length>0&&!d.value?(n(),r("div",X,[t[8]||(t[8]=e("label",{class:"form-label fw-bold"},"Seleccionar Cuota",-1)),e("div",Y,[(n(!0),r(P,null,N(x.value,s=>(n(),r("button",{key:s.id,class:"list-group-item list-group-item-action d-flex justify-content-between",onClick:Ce=>F(s)},[e("div",null,[e("strong",null,"Cuota "+a(s.numero_cuota),1),e("span",{class:E(["badge ms-2",s.estado==="vencida"?"bg-danger":"bg-warning"])},a(s.estado),3),t[7]||(t[7]=e("br",null,null,-1)),e("small",null,"Vence: "+a(j(s.fecha_vencimiento)),1)]),e("div",ee,[e("div",null," Saldo: Bs. "+a(m(s.monto_pendiente)),1),s.mora_calculada>0?(n(),r("div",te," Mora: Bs. "+a(m(s.mora_calculada)),1)):u("",!0),e("strong",null,"Total: Bs. "+a(m(s.total_pagar)),1)])],8,Z))),128))])])):u("",!0),d.value||i.cuota?(n(),r("div",oe,[e("div",se,[e("h5",null," Cuota "+a((d.value||i.cuota).numero_cuota),1),e("p",ae,[t[9]||(t[9]=e("strong",null,"Cliente:",-1)),p(" "+a((V=(S=(B=(d.value||i.cuota).credito)==null?void 0:B.venta)==null?void 0:S.cliente)==null?void 0:V.name),1)]),e("p",le,[t[10]||(t[10]=e("strong",null,"Saldo pendiente:",-1)),p(" Bs. "+a(m((d.value||i.cuota).monto_pendiente)),1)]),C.value>0?(n(),r("p",ne,[t[11]||(t[11]=e("strong",{class:"text-danger"},"Mora:",-1)),p(" Bs. "+a(m(C.value)),1)])):u("",!0),e("p",re,[t[12]||(t[12]=e("strong",null,"Total a pagar:",-1)),p(" Bs. "+a(m(k.value)),1)])]),e("form",{onSubmit:I(U,["prevent"])},[e("div",de,[t[13]||(t[13]=e("label",{class:"form-label"},"Monto del Pago *",-1)),b(e("input",{type:"number",step:"0.01",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=s=>l.value.monto=s),max:k.value,required:""},null,8,ue),[[f,l.value.monto]]),e("small",ie,"Máximo: Bs. "+a(m(k.value)),1),c.value.monto?(n(),r("div",me,a(c.value.monto),1)):u("",!0)]),e("div",ce,[t[15]||(t[15]=e("label",{class:"form-label"},"Método de Pago *",-1)),b(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=s=>l.value.metodo_pago_id=s),required:""},[t[14]||(t[14]=e("option",{value:""}," Seleccione... ",-1)),(n(!0),r(P,null,N(i.metodosPago,s=>(n(),r("option",{key:s.id,value:s.id},a(s.nombre),9,ve))),128))],512),[[R,l.value.metodo_pago_id]]),c.value.metodo_pago_id?(n(),r("div",be,a(c.value.metodo_pago_id),1)):u("",!0)]),e("div",pe,[t[16]||(t[16]=e("label",{class:"form-label"},"Fecha de Pago",-1)),b(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=s=>l.value.fecha=s)},null,512),[[f,l.value.fecha]])]),e("div",ge,[t[17]||(t[17]=e("label",{class:"form-label"},"Número de Comprobante",-1)),b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=s=>l.value.comprobante=s)},null,512),[[f,l.value.comprobante]])]),e("div",fe,[t[18]||(t[18]=e("label",{class:"form-label"},"Notas",-1)),b(e("textarea",{class:"form-control","onUpdate:modelValue":t[5]||(t[5]=s=>l.value.notas=s),rows:"2"},null,512),[[f,l.value.notas]])]),e("div",_e,[q(L(O),{href:o.route("pagos.index"),class:"btn btn-secondary"},{default:D(()=>[...t[19]||(t[19]=[p("Cancelar",-1)])]),_:1},8,["href"]),e("button",{type:"submit",class:"btn btn-success",disabled:g.value},[g.value?(n(),r("span",xe)):u("",!0),t[20]||(t[20]=p(" Registrar Pago ",-1))],8,ye)])],32)])):u("",!0)])])])])])]}),_:1}))}};export{Se as default};
