import{r as _,g as x,w,b as t,c as n,u as e,o as a,t as l,e as c,F as T,m as j,f as S,j as N,q as P,N as f}from"./app-DTocK5dB.js";import{u as E,_ as F}from"./AppLayout-ChHXXbMF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"container py-4"},V={key:0,class:"text-center py-5"},M={key:1,class:"text-center py-5"},$=["href"],z={key:2,class:"row"},D={class:"col-lg-8"},I={class:"card mb-4"},O={class:"card-header d-flex justify-content-between"},q={class:"card-body"},L={class:"col-md-2"},R=["src","alt"],J={class:"col-md-4"},K={class:"text-muted small mb-0"},Q={key:0,class:"text-success small mb-0"},U={class:"col-md-2"},X=["value","onChange"],A={class:"col-md-2"},G={class:"col-md-2 text-end"},H=["onClick"],W={class:"col-lg-4"},Y={class:"card sticky-top",style:{top:"20px"}},Z={class:"card-body"},tt={class:"d-flex justify-content-between mb-3"},st={class:"d-flex justify-content-between mb-3"},ot={class:"fs-4"},et={class:"mb-3"},at={class:"d-grid gap-2"},nt=["disabled"],lt={key:0},rt={key:1},mt={__name:"Index",setup(it){const{cartItems:d,cartTotal:p,removeFromCart:g,updateQuantity:y,clearCart:m,isLoading:h}=E(),b=_("efectivo"),u=_(!1),r=i=>`Bs. ${parseFloat(i).toFixed(2)}`,C=async()=>{if(d.value.length!==0){u.value=!0;try{const i=await fetch(route("ventas.contado"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({items:d.value.map(o=>({producto_id:o.producto_id,cantidad:o.cantidad})),metodo_pago:b.value})}),s=await i.json();i.ok?(m(),alert(`¡Compra realizada exitosamente! Total: ${r(s.total)}`),f.visit(route("dashboard"))):alert(s.error||"Error al procesar la compra")}catch{alert("Error de conexión")}finally{u.value=!1}}},k=()=>{f.visit(route("creditos.create"))};return(i,s)=>(a(),x(F,{title:"Mi Carrito"},{default:w(()=>[t("div",B,[s[16]||(s[16]=t("h2",{class:"mb-4"},"Mi Carrito de Compras",-1)),e(h)?(a(),n("div",V,[...s[2]||(s[2]=[t("div",{class:"spinner-border"},null,-1),t("p",{class:"mt-3"},"Cargando carrito...",-1)])])):e(d).length===0?(a(),n("div",M,[s[3]||(s[3]=t("i",{class:"bi bi-cart-x",style:{"font-size":"5rem",color:"#ccc"}},null,-1)),s[4]||(s[4]=t("h4",{class:"mt-3"},"Tu carrito está vacío",-1)),t("a",{href:i.route("catalog.index"),class:"btn btn-primary mt-3"}," Ir al catálogo ",8,$)])):(a(),n("div",z,[t("div",D,[t("div",I,[t("div",O,[t("span",null,"Productos ("+l(e(d).length)+")",1),t("button",{onClick:s[0]||(s[0]=(...o)=>e(m)&&e(m)(...o)),class:"btn btn-sm btn-outline-danger"},[...s[5]||(s[5]=[t("i",{class:"bi bi-trash"},null,-1),c(" Vaciar carrito ",-1)])])]),t("div",q,[(a(!0),n(T,null,j(e(d),o=>(a(),n("div",{key:o.id,class:"row mb-3 pb-3 border-bottom align-items-center"},[t("div",L,[t("img",{src:o.imagen||"/images/placeholder.png",alt:o.nombre,class:"img-fluid rounded"},null,8,R)]),t("div",J,[t("h6",null,l(o.nombre),1),t("p",K,l(r(o.precio_unitario)),1),o.descuento>0?(a(),n("p",Q," Descuento: "+l(r(o.descuento)),1)):S("",!0)]),t("div",U,[t("input",{type:"number",value:o.cantidad,onChange:v=>e(y)(o.id,v.target.value),class:"form-control",min:"1"},null,40,X)]),t("div",A,[t("strong",null,l(r(o.precio_final)),1)]),t("div",G,[t("strong",null,l(r(o.subtotal)),1),t("button",{onClick:v=>e(g)(o.id),class:"btn btn-sm btn-outline-danger d-block w-100 mt-2"},[...s[6]||(s[6]=[t("i",{class:"bi bi-trash"},null,-1),c(" Eliminar ",-1)])],8,H)])]))),128))])])]),t("div",W,[t("div",Y,[s[15]||(s[15]=t("div",{class:"card-header"},[t("h5",{class:"mb-0"},"Resumen de compra")],-1)),t("div",Z,[t("div",tt,[s[7]||(s[7]=t("span",null,"Subtotal:",-1)),t("strong",null,l(r(e(p))),1)]),s[14]||(s[14]=t("hr",null,null,-1)),t("div",st,[s[8]||(s[8]=t("strong",null,"Total:",-1)),t("strong",ot,l(r(e(p))),1)]),t("div",et,[s[10]||(s[10]=t("label",{class:"form-label"},"Método de pago:",-1)),N(t("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>b.value=o),class:"form-select"},[...s[9]||(s[9]=[t("option",{value:"efectivo"},"Efectivo",-1),t("option",{value:"tarjeta"},"Tarjeta",-1),t("option",{value:"transferencia"}," Transferencia ",-1)])],512),[[P,b.value]])]),t("div",at,[t("button",{onClick:C,class:"btn btn-primary btn-lg",disabled:u.value},[u.value?(a(),n("span",lt,[...s[11]||(s[11]=[t("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),c(" Procesando... ",-1)])])):(a(),n("span",rt,[...s[12]||(s[12]=[t("i",{class:"bi bi-credit-card"},null,-1),c(" Pagar ahora ",-1)])]))],8,nt),t("button",{onClick:k,class:"btn btn-outline-secondary"},[...s[13]||(s[13]=[t("i",{class:"bi bi-clock-history"},null,-1),c(" Solicitar crédito ",-1)])])])])])])]))])]),_:1}))}};export{mt as default};
