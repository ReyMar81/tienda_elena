import{r as I,g as u,w as b,b as e,a as y,c as l,f as r,e as s,t,n as f,o as a,F as Q,m as T,u as p,i as v,N as w}from"./app-DTocK5dB.js";import{_ as M}from"./AppLayout-ChHXXbMF.js";import{_ as R}from"./CreditoModal-BDlOs5R9.js";import{Q as O}from"./QRPayment-D0ROJNIA.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-BxTPNSzm.js";import"./Modal-CmbPbOej.js";import"./PrimaryButton-D4e6mMA3.js";import"./SecondaryButton-C0VSGjgM.js";const z={class:"container py-4"},L={class:"d-flex justify-content-between align-items-center mb-4"},G={class:"mb-0"},H={class:"card shadow-sm border-0 mb-4"},J={class:"card-body pt-3"},K={class:"row"},W={class:"col-md-6 border-end"},X={class:"table table-borderless mb-0"},Y={class:"badge bg-primary"},Z={key:0},_={class:"col-md-6"},ee={class:"table table-borderless mb-0"},de={key:0,class:"card shadow-sm border-0 mb-4"},oe={class:"card-body"},te={class:"row justify-content-center"},ie={class:"col-md-6"},ae={class:"alert alert-info mt-3"},se={key:0},ne={key:1},le={class:"card shadow-sm border-0 mb-4"},re={class:"card-body pt-4"},ce={class:"table-responsive"},ue={class:"table table-hover align-middle"},be={class:"fw-bold"},me={class:"text-muted"},ge={class:"text-end"},fe={class:"text-center"},pe={class:"text-end"},ve={class:"text-end fw-bold"},we={class:"table-light"},ye={class:"text-end fw-bold fs-5"},he={key:1,class:"card shadow-sm border-0 mb-4"},Ce={class:"card-body"},Pe={class:"d-flex flex-wrap gap-3"},ke={key:0,class:"alert alert-info mt-4"},xe={key:2,class:"card shadow-sm border-0"},Ee={class:"card-body"},qe={class:"d-flex gap-2"},Ne={__name:"Show",props:{pedido:{type:Object,required:!0},qrCuota:{type:Object,required:!1,default:null}},setup(d){const c=d,m=I(!1),$=i=>new Date(i).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),g=i=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(i),D=i=>`badge ${{pendiente:"bg-warning",pagado:"bg-success",anulado:"bg-danger"}[i]||"bg-secondary"}`,B=()=>{if(c.pedido.tipo_pago==="credito"){m.value=!0;return}confirm("¿Está seguro de confirmar este pedido?")&&w.patch(route("pedidos.accion",c.pedido.id),{accion:"confirmar"},{onError:o=>alert(Object.values(o).join(", "))})},F=i=>{w.patch(route("pedidos.accion",c.pedido.id),{accion:"confirmar",numero_cuotas:i},{onError:o=>alert(Object.values(o).join(", ")),onFinish:()=>m.value=!1})},S=()=>{confirm("¿Está seguro de que desea cancelar este pedido?")&&w.patch(route("pedidos.accion",c.pedido.id),{accion:"cancelar"},{onError:i=>alert(Object.values(i).join(", "))})},V=()=>{confirm("¿Está seguro de marcar este pedido como enviado?")&&w.patch(route("pedidos.marcar-enviado",c.pedido.id),{},{onError:i=>alert(Object.values(i).join(", ")),onSuccess:()=>alert("Pedido marcado como enviado exitosamente")})};return(i,o)=>(a(),u(M,{title:"Detalle del Pedido"},{default:b(()=>{var h,C,P,k,x,E;return[e("div",z,[e("div",L,[e("div",null,[e("h2",G,[o[1]||(o[1]=e("i",{class:"bi bi-bag me-2"},null,-1)),s(" Detalle del Pedido #"+t(d.pedido.id),1)]),o[2]||(o[2]=e("p",{class:"text-muted"},"Información completa del pedido",-1))])]),e("div",H,[o[13]||(o[13]=e("div",{class:"card-header bg-white border-0 pb-1"},[e("h5",{class:"fw-bold mb-0 text-primary"},[e("i",{class:"bi bi-info-circle me-2"}),s(" Información General del Pedido ")])],-1)),e("div",J,[e("div",K,[e("div",W,[e("table",X,[e("tbody",null,[e("tr",null,[o[3]||(o[3]=e("td",{class:"fw-bold"},"N° Pedido:",-1)),e("td",null,"#"+t(d.pedido.id),1)]),e("tr",null,[o[4]||(o[4]=e("td",{class:"fw-bold"},"Fecha:",-1)),e("td",null,t($(d.pedido.created_at)),1)]),e("tr",null,[o[5]||(o[5]=e("td",{class:"fw-bold"},"Estado:",-1)),e("td",null,[e("span",{class:f([d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?"badge bg-warning text-dark":D(d.pedido.estado),"badge"])},t(d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?`Crédito (${d.pedido.credito.cuotas.filter(n=>n.estado==="pagado").length}/${d.pedido.credito.cuotas.length})`:d.pedido.estado.toUpperCase()),3)])]),e("tr",null,[o[6]||(o[6]=e("td",{class:"fw-bold"},"Tipo de Pago:",-1)),e("td",null,[e("span",{class:f(d.pedido.tipo_pago==="credito"?"badge bg-info":"badge bg-success")},t(d.pedido.tipo_pago==="credito"?"A Crédito":"Al Contado"),3)])]),e("tr",null,[o[7]||(o[7]=e("td",{class:"fw-bold"},"Método de Pago:",-1)),e("td",null,[e("span",Y,t(((h=d.pedido.metodo_pago)==null?void 0:h.nombre)||((C=d.pedido.metodoPago)==null?void 0:C.nombre)||"N/A"),1)])]),d.pedido.observaciones?(a(),l("tr",Z,[o[8]||(o[8]=e("td",{class:"fw-bold"},"Observaciones:",-1)),e("td",null,t(d.pedido.observaciones),1)])):r("",!0)])])]),e("div",_,[e("table",ee,[e("tbody",null,[e("tr",null,[o[9]||(o[9]=e("td",{class:"fw-bold"},"Cliente:",-1)),e("td",null,t(((P=d.pedido.user)==null?void 0:P.nombre)||"N/A"),1)]),e("tr",null,[o[10]||(o[10]=e("td",{class:"fw-bold"},"Email:",-1)),e("td",null,t(((k=d.pedido.user)==null?void 0:k.email)||"N/A"),1)]),e("tr",null,[o[11]||(o[11]=e("td",{class:"fw-bold"},"Teléfono:",-1)),e("td",null,t(((x=d.pedido.user)==null?void 0:x.telefono)||"N/A"),1)]),e("tr",null,[o[12]||(o[12]=e("td",{class:"fw-bold"},"Dirección:",-1)),e("td",null,t(((E=d.pedido.user)==null?void 0:E.direccion)||"N/A"),1)])])])])])])]),d.pedido.estado==="pendiente"&&(d.qrCuota||d.pedido.pago_facil_qr_image)?(a(),l("div",de,[o[17]||(o[17]=e("div",{class:"card-header bg-warning text-dark border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-qr-code me-2"}),s(" Escanea el QR para Pagar ")])],-1)),e("div",oe,[e("div",te,[e("div",ie,[d.qrCuota?(a(),u(O,{key:0,"qr-image":d.qrCuota.qr_image,"transaction-id":d.qrCuota.transaction_id,monto:d.qrCuota.monto,descripcion:`Pago de la primera cuota del pedido #${d.pedido.numero_venta}`,status:d.qrCuota.status||"pending"},null,8,["qr-image","transaction-id","monto","descripcion","status"])):(a(),u(O,{key:1,"qr-image":d.pedido.pago_facil_qr_image,"transaction-id":d.pedido.pago_facil_transaction_id,monto:d.pedido.total,descripcion:`Pedido #${d.pedido.numero_venta}`,status:d.pedido.pago_facil_status||"pending"},null,8,["qr-image","transaction-id","monto","descripcion","status"]))])]),e("div",ae,[o[14]||(o[14]=e("i",{class:"bi bi-info-circle me-2"},null,-1)),o[15]||(o[15]=e("strong",null,"Instrucciones:",-1)),o[16]||(o[16]=s(" Escanea el código QR con tu app bancaria para completar el pago. ",-1)),d.qrCuota?(a(),l("span",se,"Este QR corresponde a la primera cuota. Una vez pagada, se registrará como cuota pagada en el crédito.")):(a(),l("span",ne,'Una vez confirmado el pago, el pedido pasará automáticamente a estado "Pagado".'))])])])):r("",!0),e("div",le,[o[20]||(o[20]=e("div",{class:"card-header bg-white border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-box-seam me-2"}),s(" Productos del Pedido ")])],-1)),e("div",re,[e("div",ce,[e("table",ue,[o[19]||(o[19]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Producto"),e("th",null,"Categoría"),e("th",{class:"text-end"},"Precio Unit."),e("th",{class:"text-center"},"Cantidad"),e("th",{class:"text-end"},"Descuento"),e("th",{class:"text-end"},"Subtotal")])],-1)),e("tbody",null,[(a(!0),l(Q,null,T(d.pedido.detalles,n=>{var q,N,j,A;return a(),l("tr",{key:n.id},[e("td",null,[e("div",be,t(((q=n.producto)==null?void 0:q.nombre)||"Producto no disponible"),1),e("small",me,t(((N=n.producto)==null?void 0:N.descripcion)||""),1)]),e("td",null,t(((A=(j=n.producto)==null?void 0:j.categoria)==null?void 0:A.nombre)||"N/A"),1),e("td",ge,t(g(n.precio_unitario)),1),e("td",fe,t(n.cantidad),1),e("td",pe,t(g(n.descuento*n.cantidad)),1),e("td",ve,t(g(n.subtotal)),1)])}),128))]),e("tfoot",we,[e("tr",null,[o[18]||(o[18]=e("td",{colspan:"5",class:"text-end fw-bold"},"TOTAL:",-1)),e("td",ye,t(g(d.pedido.total)),1)])])])])])]),d.pedido.estado==="pendiente"||d.pedido.estado==="pagado"&&d.pedido.origen==="online"?(a(),l("div",he,[o[27]||(o[27]=e("div",{class:"card-header bg-white border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-gear me-2"}),s(" Acciones del Pedido ")])],-1)),e("div",Ce,[e("div",Pe,[d.pedido.estado==="pendiente"?(a(),l("button",{key:0,onClick:B,class:"btn btn-success"},[...o[21]||(o[21]=[e("i",{class:"bi bi-check-circle me-1"},null,-1),s(" Confirmar Pedido ",-1)])])):r("",!0),d.pedido.estado==="pagado"&&d.pedido.origen==="online"?(a(),l("button",{key:1,onClick:V,class:"btn btn-primary"},[...o[22]||(o[22]=[e("i",{class:"bi bi-truck me-1"},null,-1),s(" Marcar como Enviado ",-1)])])):r("",!0),d.pedido.estado==="pendiente"?(a(),l("button",{key:2,onClick:S,class:"btn btn-danger"},[...o[23]||(o[23]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),s(" Cancelar Pedido ",-1)])])):r("",!0),d.pedido.estado==="pendiente"?(a(),u(p(v),{key:3,href:i.route("pedidos.edit",d.pedido.id),class:"btn btn-warning"},{default:b(()=>[...o[24]||(o[24]=[e("i",{class:"bi bi-pencil me-1"},null,-1),s(" Editar Pedido ",-1)])]),_:1},8,["href"])):r("",!0),y(p(v),{href:i.route("pedidos.index"),class:"btn btn-secondary"},{default:b(()=>[...o[25]||(o[25]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),s(" Volver a Pedidos ",-1)])]),_:1},8,["href"])]),d.pedido.tipo_pago==="credito"?(a(),l("div",ke,[...o[26]||(o[26]=[e("i",{class:"bi bi-info-circle me-2"},null,-1),e("strong",null,"Nota:",-1),s(" Al confirmar este pedido se generará automáticamente un crédito. ",-1)])])):r("",!0)])])):(a(),l("div",xe,[e("div",Ee,[e("div",{class:f(d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?"alert alert-info":d.pedido.estado==="pagado"||d.pedido.estado==="enviado"||d.pedido.estado==="completada"?"alert alert-success":"alert alert-warning")},[e("i",{class:f([d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?"bi bi-clock-history":d.pedido.estado==="pagado"||d.pedido.estado==="enviado"||d.pedido.estado==="completada"?"bi bi-check-circle":"bi bi-exclamation-triangle","me-2"])},null,2),e("strong",null,t(d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?`Crédito en Curso (${d.pedido.credito.cuotas.filter(n=>n.estado==="pagado").length}/${d.pedido.credito.cuotas.length} cuotas pagadas)`:d.pedido.estado==="pagado"?"Pedido Pagado":d.pedido.estado==="enviado"?"Pedido Enviado":d.pedido.estado==="completada"?"Pedido Confirmado":d.pedido.estado==="anulado"?"Pedido Cancelado":"Pedido Procesado"),1),s(" - "+t(d.pedido.tipo_pago==="credito"&&d.pedido.credito&&d.pedido.credito.estado==="pendiente"?"El pedido fue entregado pero el crédito sigue pendiente de pago.":"Este pedido ya fue procesado y no se puede modificar."),1)],2),e("div",qe,[y(p(v),{href:i.route("pedidos.index"),class:"btn btn-secondary"},{default:b(()=>[...o[28]||(o[28]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),s(" Volver a Pedidos ",-1)])]),_:1},8,["href"]),d.pedido.tipo_pago==="credito"&&d.pedido.credito?(a(),u(p(v),{key:0,href:i.route("creditos.show",d.pedido.credito.id),class:"btn btn-info text-white"},{default:b(()=>[...o[29]||(o[29]=[e("i",{class:"bi bi-credit-card me-1"},null,-1),s(" Ver Detalle del Crédito ",-1)])]),_:1},8,["href"])):r("",!0)])])]))]),y(R,{show:m.value,total:d.pedido.total,"cuotas-iniciales":3,onClose:o[0]||(o[0]=n=>m.value=!1),onConfirmar:F},null,8,["show","total"])]}),_:1}))}},Ie=U(Ne,[["__scopeId","data-v-ad6010f2"]]);export{Ie as default};
