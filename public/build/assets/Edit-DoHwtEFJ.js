import{T as D,r as V,h as B,E as L,c as l,a as y,u as t,Z as T,w as U,b as o,i as N,e as d,d as z,j as m,f as _,n as f,p as h,o as n,t as c,v as k,F as g,m as C}from"./app-BM_Csk7S.js";import{_ as I}from"./AppLayout-Aol2IiYi.js";import{F as G}from"./FlashNotification-D_t33ewn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"container py-4"},Z={class:"row mb-4"},q={class:"col-lg-12"},H={class:"d-flex justify-content-between align-items-center"},J={class:"row"},K={class:"col-lg-8 mx-auto"},Q={class:"card mb-4"},R={class:"card-body"},W={class:"row g-3"},X={class:"col-md-8"},Y={key:0,class:"invalid-feedback"},oo={class:"col-md-4"},so={key:0,class:"invalid-feedback"},eo={class:"col-md-12"},io={key:0,class:"invalid-feedback"},ao={class:"col-md-6"},to={key:0,class:"invalid-feedback"},lo={class:"col-md-6"},no={key:0,class:"invalid-feedback"},ro={class:"col-md-12"},co={class:"form-check form-switch"},mo={class:"form-check-label",for:"estado"},uo={class:"card mb-4"},po={class:"card-body"},bo={class:"mb-3"},_o={class:"row g-2 mb-3"},fo=["onClick"],vo={key:0},ho={key:1},yo={class:"d-flex justify-content-between align-items-start mb-2"},ko=["onClick"],go={class:"d-flex gap-3"},xo={class:"form-check"},wo=["onUpdate:modelValue","id"],Co=["for"],Vo={class:"form-check"},Uo=["onUpdate:modelValue","id"],$o=["for"],Po={key:2,class:"text-muted text-center mb-0"},Fo={class:"card mb-4"},No={class:"card-body"},Ao={class:"row g-2 mb-3"},Eo=["onClick"],Mo={key:0},So={key:1},jo={class:"fw-bold mb-2"},Do={class:"d-flex gap-3"},Bo={class:"form-check"},Lo=["onUpdate:modelValue","id"],To=["for"],zo={class:"form-check"},Io=["onUpdate:modelValue","id"],Go=["for"],Oo={key:2,class:"text-muted text-center mb-0"},Zo={class:"card"},qo={class:"card-body"},Ho={class:"d-flex gap-2 justify-content-end"},Jo=["disabled"],Ko={key:0},Qo={key:1},os={__name:"Edit",props:{promocion:Object,productos:Array,categorias:Array},setup(x){var P,F;const r=x,a=D({nombre:r.promocion.nombre,descripcion:r.promocion.descripcion,valor_descuento_decimal:r.promocion.valor_descuento_decimal,fecha_inicio:(P=r.promocion.fecha_inicio)==null?void 0:P.split("T")[0],fecha_fin:(F=r.promocion.fecha_fin)==null?void 0:F.split("T")[0],estado:r.promocion.estado,productos:[],categorias:[]}),v=V(""),A=B(()=>v.value?r.productos.filter(i=>i.nombre.toLowerCase().includes(v.value.toLowerCase())||i.codigo.toLowerCase().includes(v.value.toLowerCase())):r.productos),p=V([]),E=i=>{p.value.find(s=>s.id===i.id)||p.value.push({id:i.id,nombre:i.nombre,codigo:i.codigo,aplica_mayorista:!1,aplica_minorista:!1}),v.value=""},M=i=>{p.value.splice(i,1)},u=V([]),S=i=>{const s=u.value.findIndex(e=>e.id===i.id);s>-1?u.value.splice(s,1):u.value.push({id:i.id,nombre:i.nombre,aplica_mayorista:!1,aplica_minorista:!1})},$=i=>u.value.some(s=>s.id===i);L(()=>{r.promocion.productos&&(p.value=r.promocion.productos.map(i=>{var s,e;return{id:i.id,nombre:i.nombre,codigo:i.codigo,aplica_mayorista:((s=i.pivot)==null?void 0:s.aplica_mayorista)||!1,aplica_minorista:((e=i.pivot)==null?void 0:e.aplica_minorista)||!1}})),r.promocion.categorias&&(u.value=r.promocion.categorias.map(i=>{var s,e;return{id:i.id,nombre:i.nombre,aplica_mayorista:((s=i.pivot)==null?void 0:s.aplica_mayorista)||!1,aplica_minorista:((e=i.pivot)==null?void 0:e.aplica_minorista)||!1}}))});const j=()=>{a.productos=p.value.map(i=>({id:i.id,aplica_mayorista:i.aplica_mayorista,aplica_minorista:i.aplica_minorista})),a.categorias=u.value.map(i=>({id:i.id,aplica_mayorista:i.aplica_mayorista,aplica_minorista:i.aplica_minorista})),a.put(route("promociones.update",r.promocion.id),{preserveScroll:!0})};return(i,s)=>(n(),l(g,null,[y(t(T),{title:`Editar: ${x.promocion.nombre}`},null,8,["title"]),y(I,{title:`Editar: ${x.promocion.nombre}`},{default:U(()=>[y(G),o("div",O,[o("div",Z,[o("div",q,[o("div",H,[s[8]||(s[8]=o("div",null,[o("h2",{class:"mb-0"},"Editar Promoción"),o("p",{class:"text-muted"}," Actualiza la información de la oferta o descuento ")],-1)),y(t(N),{href:i.route("promociones.index"),class:"btn btn-outline-secondary"},{default:U(()=>[...s[7]||(s[7]=[o("i",{class:"bi bi-arrow-left me-2"},null,-1),d(" Volver ",-1)])]),_:1},8,["href"])])])]),o("form",{onSubmit:z(j,["prevent"])},[o("div",J,[o("div",K,[o("div",Q,[s[14]||(s[14]=o("div",{class:"card-header"},[o("h5",{class:"mb-0"},"Información General")],-1)),o("div",R,[o("div",W,[o("div",X,[s[9]||(s[9]=o("label",{class:"form-label"},[d("Nombre "),o("span",{class:"text-danger"},"*")],-1)),m(o("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>t(a).nombre=e),type:"text",class:f(["form-control",{"is-invalid":t(a).errors.nombre}]),placeholder:"Ej: Descuento Navidad 2025"},null,2),[[h,t(a).nombre]]),t(a).errors.nombre?(n(),l("div",Y,c(t(a).errors.nombre),1)):_("",!0)]),o("div",oo,[s[10]||(s[10]=o("label",{class:"form-label"},[d("Descuento (%) "),o("span",{class:"text-danger"},"*")],-1)),m(o("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>t(a).valor_descuento_decimal=e),type:"number",step:"0.01",min:"0",max:"100",class:f(["form-control",{"is-invalid":t(a).errors.valor_descuento_decimal}]),placeholder:"15"},null,2),[[h,t(a).valor_descuento_decimal]]),t(a).errors.valor_descuento_decimal?(n(),l("div",so,c(t(a).errors.valor_descuento_decimal),1)):_("",!0)]),o("div",eo,[s[11]||(s[11]=o("label",{class:"form-label"},"Descripción",-1)),m(o("textarea",{"onUpdate:modelValue":s[2]||(s[2]=e=>t(a).descripcion=e),class:f(["form-control",{"is-invalid":t(a).errors.descripcion}]),rows:"2",placeholder:"Descripción opcional de la promoción"},null,2),[[h,t(a).descripcion]]),t(a).errors.descripcion?(n(),l("div",io,c(t(a).errors.descripcion),1)):_("",!0)]),o("div",ao,[s[12]||(s[12]=o("label",{class:"form-label"},[d("Fecha Inicio "),o("span",{class:"text-danger"},"*")],-1)),m(o("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>t(a).fecha_inicio=e),type:"date",class:f(["form-control",{"is-invalid":t(a).errors.fecha_inicio}])},null,2),[[h,t(a).fecha_inicio]]),t(a).errors.fecha_inicio?(n(),l("div",to,c(t(a).errors.fecha_inicio),1)):_("",!0)]),o("div",lo,[s[13]||(s[13]=o("label",{class:"form-label"},[d("Fecha Fin "),o("span",{class:"text-danger"},"*")],-1)),m(o("input",{"onUpdate:modelValue":s[4]||(s[4]=e=>t(a).fecha_fin=e),type:"date",class:f(["form-control",{"is-invalid":t(a).errors.fecha_fin}])},null,2),[[h,t(a).fecha_fin]]),t(a).errors.fecha_fin?(n(),l("div",no,c(t(a).errors.fecha_fin),1)):_("",!0)]),o("div",ro,[o("div",co,[m(o("input",{"onUpdate:modelValue":s[5]||(s[5]=e=>t(a).estado=e),class:"form-check-input",type:"checkbox",id:"estado",role:"switch"},null,512),[[k,t(a).estado]]),o("label",mo,c(t(a).estado?"Activa":"Inactiva"),1)])])])])]),o("div",uo,[s[20]||(s[20]=o("div",{class:"card-header"},[o("h5",{class:"mb-0"}," Aplicar a Productos Específicos ")],-1)),o("div",po,[o("div",bo,[s[15]||(s[15]=o("label",{class:"form-label"},"Buscar Producto",-1)),m(o("input",{"onUpdate:modelValue":s[6]||(s[6]=e=>v.value=e),type:"text",class:"form-control",placeholder:"Buscar por nombre o código..."},null,512),[[h,v.value]])]),o("div",_o,[(n(!0),l(g,null,C(A.value.slice(0,10),e=>(n(),l("div",{key:e.id,class:"col-md-6"},[o("button",{type:"button",class:"btn btn-sm btn-outline-primary w-100 text-start",onClick:b=>E(e)},[s[16]||(s[16]=o("i",{class:"bi bi-plus-circle me-1"},null,-1)),d(" "+c(e.codigo)+" - "+c(e.nombre),1)],8,fo)]))),128))]),p.value.length>0?(n(),l("hr",vo)):_("",!0),p.value.length>0?(n(),l("div",ho,[s[18]||(s[18]=o("label",{class:"form-label fw-bold"},"Productos Seleccionados:",-1)),(n(!0),l(g,null,C(p.value,(e,b)=>(n(),l("div",{key:e.id,class:"border rounded p-3 mb-2"},[o("div",yo,[o("div",null,[o("strong",null,c(e.codigo),1),d(" - "+c(e.nombre),1)]),o("button",{type:"button",class:"btn btn-sm btn-danger",onClick:w=>M(b)},[...s[17]||(s[17]=[o("i",{class:"bi bi-trash"},null,-1)])],8,ko)]),o("div",go,[o("div",xo,[m(o("input",{"onUpdate:modelValue":w=>e.aplica_minorista=w,class:"form-check-input",type:"checkbox",id:`prod-minorista-${e.id}`},null,8,wo),[[k,e.aplica_minorista]]),o("label",{class:"form-check-label",for:`prod-minorista-${e.id}`}," Precio Minorista ",8,Co)]),o("div",Vo,[m(o("input",{"onUpdate:modelValue":w=>e.aplica_mayorista=w,class:"form-check-input",type:"checkbox",id:`prod-mayorista-${e.id}`},null,8,Uo),[[k,e.aplica_mayorista]]),o("label",{class:"form-check-label",for:`prod-mayorista-${e.id}`}," Precio Mayorista ",8,$o)])])]))),128))])):(n(),l("p",Po,[...s[19]||(s[19]=[o("i",{class:"bi bi-inbox"},null,-1),d(" No hay productos seleccionados ",-1)])]))])]),o("div",Fo,[s[23]||(s[23]=o("div",{class:"card-header"},[o("h5",{class:"mb-0"}," Aplicar a Categorías Completas ")],-1)),o("div",No,[o("div",Ao,[(n(!0),l(g,null,C(x.categorias,e=>(n(),l("div",{key:e.id,class:"col-md-6"},[o("button",{type:"button",class:f(["btn btn-sm w-100 text-start",$(e.id)?"btn-success":"btn-outline-secondary"]),onClick:b=>S(e)},[o("i",{class:f(["bi me-1",$(e.id)?"bi-check-circle-fill":"bi-circle"])},null,2),d(" "+c(e.nombre),1)],10,Eo)]))),128))]),u.value.length>0?(n(),l("hr",Mo)):_("",!0),u.value.length>0?(n(),l("div",So,[s[21]||(s[21]=o("label",{class:"form-label fw-bold"},"Categorías Seleccionadas:",-1)),(n(!0),l(g,null,C(u.value,e=>(n(),l("div",{key:e.id,class:"border rounded p-3 mb-2 bg-light"},[o("div",jo,c(e.nombre),1),o("div",Do,[o("div",Bo,[m(o("input",{"onUpdate:modelValue":b=>e.aplica_minorista=b,class:"form-check-input",type:"checkbox",id:`cat-minorista-${e.id}`},null,8,Lo),[[k,e.aplica_minorista]]),o("label",{class:"form-check-label",for:`cat-minorista-${e.id}`}," Precio Minorista ",8,To)]),o("div",zo,[m(o("input",{"onUpdate:modelValue":b=>e.aplica_mayorista=b,class:"form-check-input",type:"checkbox",id:`cat-mayorista-${e.id}`},null,8,Io),[[k,e.aplica_mayorista]]),o("label",{class:"form-check-label",for:`cat-mayorista-${e.id}`}," Precio Mayorista ",8,Go)])])]))),128))])):(n(),l("p",Oo,[...s[22]||(s[22]=[o("i",{class:"bi bi-inbox"},null,-1),d(" No hay categorías seleccionadas ",-1)])]))])]),o("div",Zo,[o("div",qo,[o("div",Ho,[y(t(N),{href:i.route("promociones.index"),class:"btn btn-secondary"},{default:U(()=>[...s[24]||(s[24]=[d(" Cancelar ",-1)])]),_:1},8,["href"]),o("button",{type:"submit",class:"btn btn-primary",disabled:t(a).processing},[t(a).processing?(n(),l("span",Ko,[...s[25]||(s[25]=[o("i",{class:"bi bi-hourglass-split me-2"},null,-1),d(" Actualizando... ",-1)])])):(n(),l("span",Qo,[...s[26]||(s[26]=[o("i",{class:"bi bi-save me-2"},null,-1),d(" Actualizar Promoción ",-1)])]))],8,Jo)])])])])])],32)])]),_:1},8,["title"])],64))}};export{os as default};
