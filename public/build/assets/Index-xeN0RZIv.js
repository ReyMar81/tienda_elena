import{_ as X}from"./AppLayout-Aol2IiYi.js";import{h as M,r as S,g as A,w as r,b as t,a as m,c as i,u as f,i as k,e as o,n as b,o as l,f as v,F as z,m as G,t as d,N as x}from"./app-BM_Csk7S.js";import{_ as I}from"./ConfirmationModal-DXXzJLlr.js";import{_ as Y}from"./CreditoModal-CA9nXI4n.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DVp3ZsaT.js";import"./DialogModal-KP0K2W7x.js";import"./PrimaryButton-DmRnZn5i.js";import"./SecondaryButton-CbdVSPUO.js";const Z={class:"container py-4"},ee={class:"d-flex justify-content-between align-items-center mb-4"},te={class:"d-flex flex-wrap gap-3 mb-4 align-items-center"},se={class:"btn-group",role:"group"},ne={class:"nav nav-pills"},le={class:"nav-item"},oe={class:"nav-item"},ie={class:"nav-item"},ae={class:"nav-item"},re={key:0,class:"card"},de={class:"card-body"},ue={class:"table-responsive"},ce={class:"table table-hover"},be={key:0},me={class:"text-muted"},ve={key:0},pe={key:0},ge={key:1,class:"text-muted"},fe={class:"text-center"},ke={key:0,class:"btn-group btn-group-sm",role:"group"},ye=["onClick"],Ce=["onClick"],xe={key:1,class:"btn-group btn-group-sm",role:"group"},we=["onClick"],$e=["onClick"],Pe={key:0,class:"mt-3"},Ee={class:"pagination justify-content-center"},Se={key:1,class:"page-link"},he={key:1,class:"alert alert-info"},Ne={class:"mb-0"},Fe={class:"mb-0"},qe={__name:"Index",props:{pedidos:Object,filtro_origen:String,filtro_estado:String},setup(a){const $=a,y=M(()=>$.filtro_origen||"tienda"),w=M(()=>$.filtro_estado||"pendiente"),W=n=>parseFloat(n||0).toFixed(2),_=n=>`bg-${{pendiente:"warning",pagado:"success",enviado:"info",anulado:"danger"}[n]||"secondary"}`,h=S(!1),N=S(!1),P=S(!1),u=S(null),H=n=>{u.value=n,h.value=!0},J=()=>{if(!u.value)return;if(u.value.tipo_pago==="credito"){P.value=!0;return}x.patch(route("pedidos.accion",u.value.id),{accion:"confirmar"},{onFinish:()=>{p()}})},K=n=>{x.patch(route("pedidos.accion",u.value.id),{accion:"confirmar",numero_cuotas:n},{onFinish:()=>{p(),P.value=!1}})},B=n=>{u.value=n,N.value=!0},Q=()=>{u.value&&x.patch(route("pedidos.accion",u.value.id),{accion:"cancelar"},{onFinish:()=>{p()}})},p=()=>{h.value=!1,N.value=!1,u.value=null},R=n=>{confirm(`¿Está seguro de marcar el pedido #${n.id} como enviado?`)&&x.patch(route("pedidos.marcar-enviado",n.id),{},{preserveState:!1,preserveScroll:!1})},E=n=>{x.get(route("pedidos.index"),{origen:y.value,estado:n},{preserveState:!1,preserveScroll:!1})},V=n=>{x.get(route("pedidos.index"),{origen:n,estado:w.value},{preserveState:!1,preserveScroll:!1})},U=M(()=>{const n=$.pedidos.current_page,e=$.pedidos.last_page,g=2,s=[],c=[];for(let C=Math.max(2,n-g);C<=Math.min(e-1,n+g);C++)s.push(C);return n-g>2?c.push(1,"..."):c.push(1),c.push(...s),n+g<e-1?c.push("...",e):e>1&&c.push(e),c});return(n,e)=>(l(),A(X,{title:"Gestión de Pedidos"},{default:r(()=>{var g;return[t("div",Z,[t("div",ee,[e[8]||(e[8]=t("div",null,[t("h2",null,"Gestión de Pedidos"),t("p",{class:"text-muted mb-0"}," Administra los pedidos realizados por clientes ")],-1)),m(f(k),{href:n.route("pedidos.create"),class:"btn btn-primary"},{default:r(()=>[...e[7]||(e[7]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),o(" Nuevo Pedido ",-1)])]),_:1},8,["href"])]),t("div",te,[t("div",null,[t("div",se,[t("button",{class:b(["btn btn-outline-primary",{active:y.value==="tienda"}]),onClick:e[0]||(e[0]=s=>V("tienda"))},[...e[9]||(e[9]=[t("i",{class:"bi bi-shop me-1"},null,-1),o(" Tienda ",-1)])],2),t("button",{class:b(["btn btn-outline-success",{active:y.value==="online"}]),onClick:e[1]||(e[1]=s=>V("online"))},[...e[10]||(e[10]=[t("i",{class:"bi bi-globe2 me-1"},null,-1),o(" Online ",-1)])],2)])]),t("div",null,[t("ul",ne,[t("li",le,[t("button",{class:b(["nav-link",{active:w.value==="pendiente"}]),onClick:e[2]||(e[2]=s=>E("pendiente"))},[...e[11]||(e[11]=[t("i",{class:"bi bi-clock-history me-2"},null,-1),o(" Pendientes ",-1)])],2)]),t("li",oe,[t("button",{class:b(["nav-link",{active:w.value==="pagado"}]),onClick:e[3]||(e[3]=s=>E("pagado"))},[...e[12]||(e[12]=[t("i",{class:"bi bi-cash-coin me-2"},null,-1),o(" Pagados ",-1)])],2)]),t("li",ie,[t("button",{class:b(["nav-link",{active:w.value==="enviado"}]),onClick:e[4]||(e[4]=s=>E("enviado"))},[...e[13]||(e[13]=[t("i",{class:"bi bi-truck me-2"},null,-1),o(" Enviados ",-1)])],2)]),t("li",ae,[t("button",{class:b(["nav-link",{active:w.value==="anulado"}]),onClick:e[5]||(e[5]=s=>E("anulado"))},[...e[14]||(e[14]=[t("i",{class:"bi bi-x-circle me-2"},null,-1),o(" Anulados ",-1)])],2)])])])]),a.pedidos.data.length>0?(l(),i("div",re,[t("div",de,[t("div",ue,[t("table",ce,[t("thead",null,[t("tr",null,[e[15]||(e[15]=t("th",null,"N° Pedido",-1)),e[16]||(e[16]=t("th",null,"Fecha",-1)),e[17]||(e[17]=t("th",null,"Cliente",-1)),e[18]||(e[18]=t("th",null,"Método de Pago",-1)),e[19]||(e[19]=t("th",null,"Tipo de Pago",-1)),y.value==="online"?(l(),i("th",be,"Dirección de Entrega")):v("",!0),e[20]||(e[20]=t("th",null,"Total",-1)),e[21]||(e[21]=t("th",null,"Estado",-1)),e[22]||(e[22]=t("th",{class:"text-center"},"Acciones",-1))])]),t("tbody",null,[(l(!0),i(z,null,G(a.pedidos.data,s=>{var c,C,j,D,O,T,L,q;return l(),i("tr",{key:s.id},[t("td",null,[t("strong",null,"#"+d(s.id),1)]),t("td",null,d(new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})),1),t("td",null,[t("div",null,[t("strong",null,d((c=s.user)==null?void 0:c.nombre),1),o(" "+d((C=s.user)==null?void 0:C.apellidos),1)]),t("small",me,d((j=s.user)==null?void 0:j.email),1)]),t("td",null,[t("span",{class:b(["badge",((T=((D=s.metodo_pago)==null?void 0:D.nombre)||((O=s.metodoPago)==null?void 0:O.nombre)||"")==null?void 0:T.toLowerCase())==="crédito"?"bg-info":"bg-primary"])},d(((L=s.metodo_pago)==null?void 0:L.nombre)||((q=s.metodoPago)==null?void 0:q.nombre)||"N/A"),3)]),t("td",null,[t("span",{class:b(s.tipo_pago==="credito"?"badge bg-warning":"badge bg-success")},d(s.tipo_pago==="credito"?"A Crédito":"Al Contado"),3)]),y.value==="online"?(l(),i("td",ve,[s.direccion_entrega?(l(),i("span",pe,d(s.direccion_entrega),1)):(l(),i("span",ge,"-"))])):v("",!0),t("td",null,[t("strong",null,"Bs. "+d(W(s.total)),1)]),t("td",null,[t("span",{class:b(["badge",_(s.estado)])},d(s.estado),3)]),t("td",fe,[y.value==="tienda"?(l(),i("div",ke,[m(f(k),{href:n.route("pedidos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles"},{default:r(()=>[...e[23]||(e[23]=[t("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),s.estado==="pendiente"?(l(),A(f(k),{key:0,href:n.route("pedidos.edit",s.id),class:"btn btn-outline-warning",title:"Editar pedido"},{default:r(()=>[...e[24]||(e[24]=[t("i",{class:"bi bi-pencil"},null,-1)])]),_:1},8,["href"])):v("",!0),s.estado==="pendiente"?(l(),i("button",{key:1,onClick:F=>H(s),class:"btn btn-outline-success",title:"Confirmar pedido",type:"button"},[...e[25]||(e[25]=[t("i",{class:"bi bi-check-circle"},null,-1)])],8,ye)):v("",!0),s.estado==="pendiente"?(l(),i("button",{key:2,onClick:F=>B(s),class:"btn btn-outline-danger",title:"Cancelar pedido",type:"button"},[...e[26]||(e[26]=[t("i",{class:"bi bi-x-circle"},null,-1)])],8,Ce)):v("",!0)])):(l(),i("div",xe,[m(f(k),{href:n.route("pedidos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles"},{default:r(()=>[...e[27]||(e[27]=[t("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),s.estado==="pendiente"?(l(),i("button",{key:0,onClick:F=>B(s),class:"btn btn-outline-danger",title:"Cancelar pedido",type:"button"},[...e[28]||(e[28]=[t("i",{class:"bi bi-x-circle"},null,-1)])],8,we)):v("",!0),s.estado==="pagado"?(l(),i("button",{key:1,onClick:F=>R(s),class:"btn btn-outline-primary",title:"Marcar como enviado",type:"button"},[...e[29]||(e[29]=[t("i",{class:"bi bi-truck"},null,-1)])],8,$e)):v("",!0)]))])])}),128))])])]),a.pedidos.last_page>1?(l(),i("nav",Pe,[t("ul",Ee,[t("li",{class:b(["page-item",{disabled:!a.pedidos.prev_page_url}])},[m(f(k),{class:"page-link",href:a.pedidos.prev_page_url||"#",disabled:!a.pedidos.prev_page_url},{default:r(()=>[...e[30]||(e[30]=[o(" Anterior ",-1)])]),_:1},8,["href","disabled"])],2),(l(!0),i(z,null,G(U.value,s=>{var c;return l(),i("li",{key:s,class:b(["page-item",{active:s===a.pedidos.current_page,disabled:s==="..."}])},[s!=="..."?(l(),A(f(k),{key:0,class:"page-link",href:((c=a.pedidos.links[s])==null?void 0:c.url)||"#"},{default:r(()=>[o(d(s),1)]),_:2},1032,["href"])):(l(),i("span",Se,"..."))],2)}),128)),t("li",{class:b(["page-item",{disabled:!a.pedidos.next_page_url}])},[m(f(k),{class:"page-link",href:a.pedidos.next_page_url||"#",disabled:!a.pedidos.next_page_url},{default:r(()=>[...e[31]||(e[31]=[o(" Siguiente ",-1)])]),_:1},8,["href","disabled"])],2)])])):v("",!0)])])):(l(),i("div",he,[e[32]||(e[32]=t("i",{class:"bi bi-info-circle"},null,-1)),o(" No hay pedidos "+d(a.filtro_estado==="pendiente"?"pendientes":a.filtro_estado==="pagado"?"pagados":a.filtro_estado==="enviado"?"enviados":"anulados")+". ",1)]))]),m(I,{show:h.value,onClose:p,"max-width":"sm"},{title:r(()=>[...e[33]||(e[33]=[o(" Confirmar Pedido ",-1)])]),content:r(()=>{var s;return[t("p",Ne,[e[34]||(e[34]=o(" ¿Está seguro de que desea confirmar el pedido ",-1)),t("strong",null,"#"+d((s=u.value)==null?void 0:s.id),1),e[35]||(e[35]=o("? ",-1))]),e[36]||(e[36]=t("p",{class:"text-muted small mb-0 mt-2"}," Esta acción convertirá el pedido en una venta. ",-1))]}),footer:r(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:p}," Cancelar "),t("button",{type:"button",class:"btn btn-success",onClick:J},[...e[37]||(e[37]=[t("i",{class:"bi bi-check-circle me-2"},null,-1),o(" Confirmar ",-1)])])]),_:1},8,["show"]),m(I,{show:N.value,onClose:p,"max-width":"sm"},{title:r(()=>[...e[38]||(e[38]=[o(" Cancelar Pedido ",-1)])]),content:r(()=>{var s;return[t("p",Fe,[e[39]||(e[39]=o(" ¿Está seguro de que desea cancelar el pedido ",-1)),t("strong",null,"#"+d((s=u.value)==null?void 0:s.id),1),e[40]||(e[40]=o("? ",-1))]),e[41]||(e[41]=t("p",{class:"text-muted small mb-0 mt-2"}," El stock de los productos será devuelto automáticamente. ",-1))]}),footer:r(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:p}," No, volver "),t("button",{type:"button",class:"btn btn-danger",onClick:Q},[...e[42]||(e[42]=[t("i",{class:"bi bi-x-circle me-2"},null,-1),o(" Sí, cancelar pedido ",-1)])])]),_:1},8,["show"]),m(Y,{show:P.value,total:((g=u.value)==null?void 0:g.total)||0,"cuotas-iniciales":3,onClose:e[6]||(e[6]=s=>P.value=!1),onConfirmar:K},null,8,["show","total"])]}),_:1}))}};export{qe as default};
