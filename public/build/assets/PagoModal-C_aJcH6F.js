import{T as q,z as h,h as g,g as E,w as c,a as P,b as r,e as y,u as s,d as T,j as f,c as n,f as m,n as _,o as i,F as S,m as x,t as l,q as C,p as D}from"./app-DTocK5dB.js";import{_ as O}from"./DialogModal-BxTPNSzm.js";import{_ as U}from"./PrimaryButton-D4e6mMA3.js";import{_ as I}from"./SecondaryButton-C0VSGjgM.js";const $={class:"mb-3"},z=["disabled"],A=["value"],L={key:0,class:"invalid-feedback"},R={class:"row"},j={class:"col-md-6 mb-3"},G=["max"],H={key:0,class:"text-muted"},J={key:1,class:"invalid-feedback"},K={class:"col-md-6 mb-3"},Q=["max"],W={key:0,class:"invalid-feedback"},X={class:"mb-3"},Y=["value"],Z={key:0,class:"invalid-feedback"},se={__name:"PagoModal",props:{show:Boolean,cuotas:Array,metodosPago:Array,cuotaPreseleccionada:{type:Number,default:null}},emits:["close"],setup(u,{emit:M}){const d=u,B=M,o=q({cuota_id:"",metodo_pago_id:"",monto:"",fecha:new Date().toISOString().split("T")[0]});h(()=>d.cuotaPreseleccionada,a=>{var e;if(a){o.cuota_id=a;const t=(e=d.cuotas)==null?void 0:e.find(v=>v.id===a);t&&(o.monto=t.monto_pendiente)}},{immediate:!0});const F=g(()=>{var a;return((a=d.cuotas)==null?void 0:a.filter(e=>e.estado==="pendiente"||e.estado==="vencido"))||[]}),p=g(()=>{var a;return(a=d.cuotas)==null?void 0:a.find(e=>e.id===o.cuota_id)}),N=g(()=>{var a;return((a=p.value)==null?void 0:a.monto_pendiente)||0});h(()=>o.cuota_id,a=>{var e;if(a){const t=(e=d.cuotas)==null?void 0:e.find(v=>v.id===a);t&&(o.monto=t.monto_pendiente)}});const k=a=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(a),V=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),b=()=>{o.reset(),o.clearErrors(),B("close")},w=()=>{if(!o.cuota_id){alert("Debe seleccionar una cuota");return}if(!o.metodo_pago_id){alert("Debe seleccionar un método de pago");return}if(!o.monto||o.monto<=0){alert("Debe ingresar un monto válido");return}if(!o.fecha){alert("Debe seleccionar la fecha de pago");return}o.post(route("creditos.registrar-pago"),{preserveScroll:!0,onSuccess:()=>{b()},onError:a=>{console.error("Errores al registrar pago:",a)}})};return(a,e)=>(i(),E(O,{show:u.show,onClose:b,"max-width":"md"},{title:c(()=>[...e[4]||(e[4]=[r("i",{class:"bi bi-cash-coin me-2"},null,-1),y(" Registrar Pago de Cuota ",-1)])]),content:c(()=>[r("form",{onSubmit:T(w,["prevent"])},[r("div",$,[e[6]||(e[6]=r("label",{class:"form-label fw-bold"},"Cuota a Pagar",-1)),f(r("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>s(o).cuota_id=t),class:_(["form-select",{"is-invalid":s(o).errors.cuota_id}]),disabled:!!u.cuotaPreseleccionada,required:""},[e[5]||(e[5]=r("option",{value:""},"Seleccione una cuota...",-1)),(i(!0),n(S,null,x(F.value,t=>(i(),n("option",{key:t.id,value:t.id}," Cuota #"+l(t.numero_cuota)+" - Pendiente: "+l(k(t.monto_pendiente))+" (Vence: "+l(V(t.fecha_vencimiento))+") ",9,A))),128))],10,z),[[C,s(o).cuota_id]]),s(o).errors.cuota_id?(i(),n("div",L,l(s(o).errors.cuota_id),1)):m("",!0)]),r("div",R,[r("div",j,[e[7]||(e[7]=r("label",{class:"form-label fw-bold"},"Monto a Pagar *",-1)),f(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s(o).monto=t),type:"number",step:"0.01",class:_(["form-control",{"is-invalid":s(o).errors.monto}]),max:N.value,required:""},null,10,G),[[D,s(o).monto]]),p.value?(i(),n("small",H," Máximo: "+l(k(p.value.monto_pendiente)),1)):m("",!0),s(o).errors.monto?(i(),n("div",J,l(s(o).errors.monto),1)):m("",!0)]),r("div",K,[e[8]||(e[8]=r("label",{class:"form-label fw-bold"},"Fecha de Pago *",-1)),f(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s(o).fecha=t),type:"date",class:_(["form-control",{"is-invalid":s(o).errors.fecha}]),max:new Date().toISOString().split("T")[0],required:""},null,10,Q),[[D,s(o).fecha]]),s(o).errors.fecha?(i(),n("div",W,l(s(o).errors.fecha),1)):m("",!0)])]),r("div",X,[e[10]||(e[10]=r("label",{class:"form-label fw-bold"},"Método de Pago *",-1)),f(r("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s(o).metodo_pago_id=t),class:_(["form-select",{"is-invalid":s(o).errors.metodo_pago_id}]),required:""},[e[9]||(e[9]=r("option",{value:""},"Seleccione...",-1)),(i(!0),n(S,null,x(u.metodosPago,t=>(i(),n("option",{key:t.id,value:t.id},l(t.nombre),9,Y))),128))],2),[[C,s(o).metodo_pago_id]]),s(o).errors.metodo_pago_id?(i(),n("div",Z,l(s(o).errors.metodo_pago_id),1)):m("",!0)])],32)]),footer:c(()=>[P(I,{onClick:b},{default:c(()=>[...e[11]||(e[11]=[r("i",{class:"bi bi-x-circle me-2"},null,-1),y(" Cancelar ",-1)])]),_:1}),P(U,{class:"ms-3",onClick:w,disabled:s(o).processing},{default:c(()=>[...e[12]||(e[12]=[r("i",{class:"bi bi-check-circle me-2"},null,-1),y(" Registrar Pago ",-1)])]),_:1},8,["disabled"])]),_:1},8,["show"]))}};export{se as _};
