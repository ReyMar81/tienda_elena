import{h as q,r as b,c as d,a as x,f as p,w as _,b as t,e as i,t as s,u as Q,i as R,n as T,o as r,x as W,F as k,m as U,j as M,q as X,p as z,N as L}from"./app-BM_Csk7S.js";import{_ as Y}from"./AppLayout-Aol2IiYi.js";import{F as Z}from"./FlashNotification-D_t33ewn.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const tt={class:"container py-4"},et={class:"row mb-4"},st={class:"col-lg-12"},ot={class:"d-flex justify-content-between align-items-center"},nt={class:"mb-0"},at={class:"card mb-4"},lt={class:"card-body"},dt={class:"row"},it={class:"col-md-6"},rt={class:"col-md-6"},ct={key:0},ut={class:"badge bg-danger"},mt={class:"row"},bt={class:"col-md-3"},vt={class:"text-primary"},gt={class:"col-md-3"},ft={class:"col-md-3"},pt={class:"text-success"},yt={class:"col-md-3"},ht={class:"text-danger"},xt={class:"mt-3"},wt={class:"progress",style:{height:"30px"}},Ct={class:"card mb-4"},_t={class:"card-body"},kt={class:"table-responsive"},Mt={class:"table table-hover"},Pt={class:"text-end"},St={class:"text-end text-success"},Ft={class:"text-end text-danger"},Dt={class:"text-center"},Vt={key:0,class:"badge bg-danger"},It={key:1,class:"text-muted"},Nt={class:"text-center"},Bt=["onClick"],Ot={class:"d-flex gap-3"},Et={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.3)"}},jt={class:"modal-dialog"},qt={class:"modal-content"},Qt={class:"modal-body"},Rt={class:"mb-3"},Tt=["value"],Ut={key:0},zt={class:"mb-3"},Lt=["max"],$t={class:"mb-3"},At={class:"modal-footer"},Gt=["disabled"],Ht=["disabled"],Jt={key:0,class:"spinner-border spinner-border-sm me-2"},te={__name:"Show",props:{credito:Object},setup(o){const y=o,m=n=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(n),w=n=>new Date(n).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),$=n=>({pendiente:"badge bg-warning",pagado:"badge bg-success",vencido:"badge bg-danger"})[n]||"badge bg-secondary",A=n=>({pendiente:"badge bg-warning",pagado:"badge bg-success",vencido:"badge bg-danger"})[n]||"badge bg-secondary",P=q(()=>y.credito.monto_credito===0?0:y.credito.monto_pagado/y.credito.monto_credito*100),h=b(!1),u=b(null),c=b(0),v=b(new Date().toISOString().slice(0,10)),g=b(""),f=b(!1),G=()=>{u.value=null,g.value="",c.value=0,v.value=new Date().toISOString().slice(0,10),h.value=!0},H=n=>{u.value=n,g.value=n.id.toString(),c.value=n.monto_pendiente,v.value=new Date().toISOString().slice(0,10),h.value=!0},C=()=>{h.value=!1,u.value=null,g.value="",c.value=0},S=q(()=>{var n;return((n=y.credito.cuotas)==null?void 0:n.filter(e=>e.estado!=="pagado"))||[]}),J=n=>{const e=S.value.find(a=>a.id===parseInt(n));u.value=e,c.value=e?e.monto_pendiente:0},K=()=>{!u.value||!c.value||c.value<.01||(f.value=!0,L.post(route("mis-creditos.registrar-pago"),{cuota_id:u.value.id,monto:c.value,fecha:v.value},{preserveScroll:!0,onSuccess:()=>{C(),L.reload({only:["credito"]})},onFinish:()=>{f.value=!1}}))};return(n,e)=>(r(),d(k,null,[x(Y,{title:"Detalle de Mi Crédito"},{default:_(()=>{var a,F,D,V,I,N,B,O,E,j;return[x(Z),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",null,[t("h2",nt,[e[4]||(e[4]=t("i",{class:"bi bi-credit-card me-2"},null,-1)),i(" Detalle del Crédito #"+s(o.credito.id),1)])])])])]),t("div",at,[e[21]||(e[21]=t("div",{class:"card-header bg-primary text-white"},[t("h5",{class:"mb-0"},"Información del Crédito")],-1)),t("div",lt,[t("div",dt,[t("div",it,[e[9]||(e[9]=t("h6",{class:"fw-bold mb-3"},"Cliente",-1)),t("p",null,[e[5]||(e[5]=t("strong",null,"Nombre:",-1)),i(" "+s((F=(a=o.credito.venta)==null?void 0:a.user)==null?void 0:F.nombre)+" "+s((V=(D=o.credito.venta)==null?void 0:D.user)==null?void 0:V.apellidos),1)]),t("p",null,[e[6]||(e[6]=t("strong",null,"CI:",-1)),i(" "+s((N=(I=o.credito.venta)==null?void 0:I.user)==null?void 0:N.ci),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Teléfono:",-1)),i(" "+s((O=(B=o.credito.venta)==null?void 0:B.user)==null?void 0:O.telefono),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Email:",-1)),i(" "+s((j=(E=o.credito.venta)==null?void 0:E.user)==null?void 0:j.email),1)])]),t("div",rt,[e[15]||(e[15]=t("h6",{class:"fw-bold mb-3"}," Información del Crédito ",-1)),t("p",null,[e[10]||(e[10]=t("strong",null,"Venta:",-1)),x(Q(R),{href:n.route("ventas.show",o.credito.venta_id),class:"text-primary"},{default:_(()=>{var l;return[i(s((l=o.credito.venta)==null?void 0:l.numero_venta),1)]}),_:1},8,["href"])]),t("p",null,[e[11]||(e[11]=t("strong",null,"Fecha Otorgamiento:",-1)),i(" "+s(w(o.credito.fecha_otorgamiento)),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"Fecha Vencimiento:",-1)),i(" "+s(w(o.credito.fecha_vencimiento)),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"Estado:",-1)),t("span",{class:T($(o.credito.estado))},s(o.credito.estado.toUpperCase()),3)]),o.credito.dias_mora>0?(r(),d("p",ct,[e[14]||(e[14]=t("strong",{class:"text-danger"},"Días de Mora:",-1)),t("span",ut,s(o.credito.dias_mora)+" días",1)])):p("",!0)])]),e[20]||(e[20]=t("hr",null,null,-1)),t("div",mt,[t("div",bt,[e[16]||(e[16]=t("h6",{class:"fw-bold"},"Monto Total",-1)),t("h4",vt,s(m(o.credito.monto_credito)),1)]),t("div",gt,[e[17]||(e[17]=t("h6",{class:"fw-bold"},"Total Cuotas",-1)),t("h4",null,s(o.credito.cuotas_total)+" cuotas",1)]),t("div",ft,[e[18]||(e[18]=t("h6",{class:"fw-bold"},"Monto Pagado",-1)),t("h4",pt,s(m(o.credito.monto_pagado)),1)]),t("div",yt,[e[19]||(e[19]=t("h6",{class:"fw-bold"},"Monto Pendiente",-1)),t("h4",ht,s(m(o.credito.monto_pendiente)),1)])]),t("div",xt,[t("div",wt,[t("div",{class:"progress-bar bg-success",style:W({width:P.value+"%"})},s(P.value.toFixed(1))+"% Pagado ",5)])])])]),t("div",Ct,[t("div",{class:"card-header bg-warning text-dark d-flex justify-content-between align-items-center"},[e[23]||(e[23]=t("h5",{class:"mb-0"},"Plan de Cuotas",-1)),t("button",{class:"btn btn-success btn-sm",onClick:G},[...e[22]||(e[22]=[t("i",{class:"bi bi-qr-code me-2"},null,-1),i("Pagar por QR ",-1)])])]),t("div",_t,[t("div",kt,[t("table",Mt,[e[25]||(e[25]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"#"),t("th",{class:"text-end"},"Monto"),t("th",null,"Fecha Vencimiento"),t("th",{class:"text-end"},"Monto Pagado"),t("th",{class:"text-end"},"Monto Pendiente"),t("th",{class:"text-center"},"Mora"),t("th",{class:"text-center"},"Estado")])],-1)),t("tbody",null,[(r(!0),d(k,null,U(o.credito.cuotas,l=>(r(),d("tr",{key:l.id},[t("td",null,"Cuota "+s(l.numero_cuota),1),t("td",Pt,s(m(l.monto)),1),t("td",null,s(w(l.fecha_vencimiento)),1),t("td",St,s(m(l.monto_pagado)),1),t("td",Ft,s(m(l.monto_pendiente)),1),t("td",Dt,[l.dias_mora>0?(r(),d("span",Vt,s(l.dias_mora)+" días ",1)):(r(),d("span",It,"-"))]),t("td",Nt,[t("span",{class:T(A(l.estado))},s(l.estado.toUpperCase()),3),l.estado!=="pagado"?(r(),d("button",{key:0,class:"btn btn-outline-success btn-sm ms-2",onClick:Kt=>H(l)},[...e[24]||(e[24]=[t("i",{class:"bi bi-qr-code"},null,-1)])],8,Bt)):p("",!0)])]))),128))])])])])]),t("div",Ot,[x(Q(R),{href:n.route("mis-creditos.index"),class:"btn btn-secondary"},{default:_(()=>[...e[26]||(e[26]=[t("i",{class:"bi bi-arrow-left me-2"},null,-1),i(" Volver a Mis Créditos ",-1)])]),_:1},8,["href"])])])]}),_:1}),h.value?(r(),d("div",Et,[t("div",jt,[t("div",qt,[t("div",{class:"modal-header"},[e[27]||(e[27]=t("h5",{class:"modal-title"},[t("i",{class:"bi bi-qr-code me-2"}),i("Pagar cuota por QR")],-1)),t("button",{type:"button",class:"btn-close",onClick:C})]),t("div",Qt,[t("div",Rt,[e[29]||(e[29]=t("label",{class:"form-label"},"Seleccionar cuota",-1)),M(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),onChange:e[1]||(e[1]=a=>J(a.target.value))},[e[28]||(e[28]=t("option",{value:""},"-- Seleccione una cuota --",-1)),(r(!0),d(k,null,U(S.value,a=>(r(),d("option",{key:a.id,value:a.id}," Cuota #"+s(a.numero_cuota)+" - Pendiente: "+s(m(a.monto_pendiente)),9,Tt))),128))],544),[[X,g.value]])]),u.value?(r(),d("div",Ut,[t("div",zt,[e[30]||(e[30]=t("label",{class:"form-label"},"Monto a pagar",-1)),M(t("input",{type:"number",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),max:u.value.monto_pendiente,min:"0.01",step:"0.01"},null,8,Lt),[[z,c.value]])]),t("div",$t,[e[31]||(e[31]=t("label",{class:"form-label"},"Fecha de pago",-1)),M(t("input",{type:"date",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a)},null,512),[[z,v.value]])]),e[32]||(e[32]=t("div",{class:"mb-3"},[t("label",{class:"form-label"},"Método de pago"),t("input",{type:"text",class:"form-control",value:"QR",disabled:""})],-1))])):p("",!0)]),t("div",At,[t("button",{type:"button",class:"btn btn-secondary",onClick:C,disabled:f.value},"Cancelar",8,Gt),t("button",{type:"button",class:"btn btn-success",disabled:!u.value||!c.value||c.value<.01||f.value,onClick:K},[f.value?(r(),d("span",Jt)):p("",!0),e[33]||(e[33]=t("i",{class:"bi bi-qr-code me-2"},null,-1)),e[34]||(e[34]=i("Pagar por QR ",-1))],8,Ht)])])])])):p("",!0)],64))}};export{te as default};
