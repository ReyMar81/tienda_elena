import{_ as X}from"./AppLayout-DD1QV7aw.js";import{h as M,r as S,g as A,w as r,b as e,a as m,c as i,u as f,i as k,e as l,n as b,o,f as v,F as q,m as z,t as d,N as x}from"./app-9HEqLJnm.js";import{_ as G}from"./ConfirmationModal-Bq64hp6h.js";import{_ as Y}from"./CreditoModal-DEBppTZ9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-CRs6EPgD.js";import"./DialogModal-DAvYmej3.js";import"./PrimaryButton-CtN6bpro.js";import"./SecondaryButton-D5Y2-mVN.js";const Z={class:"container py-4"},tt={class:"d-flex justify-content-between align-items-center mb-4"},et={class:"d-flex flex-wrap gap-3 mb-4 align-items-center"},st={class:"btn-group",role:"group"},nt={class:"nav nav-pills"},ot={class:"nav-item"},lt={class:"nav-item"},it={class:"nav-item"},at={class:"nav-item"},rt={key:0,class:"card"},dt={class:"card-body"},ut={class:"table-responsive"},ct={class:"table table-hover"},bt={key:0},mt={class:"text-muted"},vt={key:0},gt={key:0},pt={key:1,class:"text-muted"},ft={class:"text-center"},kt={key:0,class:"btn-group btn-group-sm",role:"group"},Ct=["onClick"],yt=["onClick"],xt={key:1,class:"btn-group btn-group-sm",role:"group"},wt=["onClick"],$t=["onClick"],ht={key:0,class:"mt-3"},Pt={class:"pagination justify-content-center"},Et={key:1,class:"page-link"},St={key:1,class:"alert alert-info"},Nt={class:"mb-0"},Ft={class:"mb-0"},_t={__name:"Index",props:{pedidos:Object,filtro_origen:String,filtro_estado:String},setup(a){const h=a,C=M(()=>h.filtro_origen||"tienda"),w=M(()=>h.filtro_estado||"pendiente"),I=n=>parseFloat(n||0).toFixed(2),W=n=>`bg-${{pendiente:"warning",pagado:"success",enviado:"info",anulado:"danger"}[n]||"secondary"}`,N=S(!1),F=S(!1),P=S(!1),u=S(null),H=n=>{u.value=n,N.value=!0},J=()=>{if(!u.value)return;if(u.value.tipo_pago==="credito"){P.value=!0;return}x.patch(route("pedidos.accion",u.value.id),{accion:"confirmar"},{onFinish:()=>{g()}})},K=n=>{x.patch(route("pedidos.accion",u.value.id),{accion:"confirmar",numero_cuotas:n},{onFinish:()=>{g(),P.value=!1}})},B=n=>{u.value=n,F.value=!0},Q=()=>{u.value&&x.patch(route("pedidos.accion",u.value.id),{accion:"cancelar"},{onFinish:()=>{g()}})},g=()=>{N.value=!1,F.value=!1,u.value=null},R=n=>{confirm(`¿Está seguro de marcar el pedido #${n.id} como enviado?`)&&x.patch(route("pedidos.marcar-enviado",n.id),{},{preserveState:!1,preserveScroll:!1})},E=n=>{x.get(route("pedidos.index"),{origen:C.value,estado:n},{preserveState:!1,preserveScroll:!1})},V=n=>{x.get(route("pedidos.index"),{origen:n,estado:w.value},{preserveState:!1,preserveScroll:!1})},U=M(()=>{const n=h.pedidos.current_page,t=h.pedidos.last_page,p=2,s=[],c=[];for(let y=Math.max(2,n-p);y<=Math.min(t-1,n+p);y++)s.push(y);return n-p>2?c.push(1,"..."):c.push(1),c.push(...s),n+p<t-1?c.push("...",t):t>1&&c.push(t),c});return(n,t)=>(o(),A(X,{title:"Gestión de Pedidos"},{default:r(()=>{var p;return[e("div",Z,[e("div",tt,[t[8]||(t[8]=e("div",null,[e("h2",null,"Gestión de Pedidos"),e("p",{class:"text-muted mb-0"}," Administra los pedidos realizados por clientes ")],-1)),m(f(k),{href:n.route("pedidos.create"),class:"btn btn-primary"},{default:r(()=>[...t[7]||(t[7]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),l(" Nuevo Pedido ",-1)])]),_:1},8,["href"])]),e("div",et,[e("div",null,[e("div",st,[e("button",{class:b(["btn btn-outline-primary",{active:C.value==="tienda"}]),onClick:t[0]||(t[0]=s=>V("tienda"))},[...t[9]||(t[9]=[e("i",{class:"bi bi-shop me-1"},null,-1),l(" Tienda ",-1)])],2),e("button",{class:b(["btn btn-outline-success",{active:C.value==="online"}]),onClick:t[1]||(t[1]=s=>V("online"))},[...t[10]||(t[10]=[e("i",{class:"bi bi-globe2 me-1"},null,-1),l(" Online ",-1)])],2)])]),e("div",null,[e("ul",nt,[e("li",ot,[e("button",{class:b(["nav-link",{active:w.value==="pendiente"}]),onClick:t[2]||(t[2]=s=>E("pendiente"))},[...t[11]||(t[11]=[e("i",{class:"bi bi-clock-history me-2"},null,-1),l(" Pendientes ",-1)])],2)]),e("li",lt,[e("button",{class:b(["nav-link",{active:w.value==="pagado"}]),onClick:t[3]||(t[3]=s=>E("pagado"))},[...t[12]||(t[12]=[e("i",{class:"bi bi-cash-coin me-2"},null,-1),l(" Pagados ",-1)])],2)]),e("li",it,[e("button",{class:b(["nav-link",{active:w.value==="enviado"}]),onClick:t[4]||(t[4]=s=>E("enviado"))},[...t[13]||(t[13]=[e("i",{class:"bi bi-truck me-2"},null,-1),l(" Enviados ",-1)])],2)]),e("li",at,[e("button",{class:b(["nav-link",{active:w.value==="anulado"}]),onClick:t[5]||(t[5]=s=>E("anulado"))},[...t[14]||(t[14]=[e("i",{class:"bi bi-x-circle me-2"},null,-1),l(" Anulados ",-1)])],2)])])])]),a.pedidos.data.length>0?(o(),i("div",rt,[e("div",dt,[e("div",ut,[e("table",ct,[e("thead",null,[e("tr",null,[t[15]||(t[15]=e("th",null,"N° Pedido",-1)),t[16]||(t[16]=e("th",null,"Fecha",-1)),t[17]||(t[17]=e("th",null,"Cliente",-1)),t[18]||(t[18]=e("th",null,"Método de Pago",-1)),t[19]||(t[19]=e("th",null,"Tipo de Pago",-1)),C.value==="online"?(o(),i("th",bt,"Dirección de Entrega")):v("",!0),t[20]||(t[20]=e("th",null,"Total",-1)),t[21]||(t[21]=e("th",null,"Estado",-1)),t[22]||(t[22]=e("th",{class:"text-center"},"Acciones",-1))])]),e("tbody",null,[(o(!0),i(q,null,z(a.pedidos.data,s=>{var c,y,j,D,O,T,L,_;return o(),i("tr",{key:s.id},[e("td",null,[e("strong",null,"#"+d(s.id),1)]),e("td",null,d(new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})),1),e("td",null,[e("div",null,[e("strong",null,d((c=s.user)==null?void 0:c.nombre),1),l(" "+d((y=s.user)==null?void 0:y.apellidos),1)]),e("small",mt,d((j=s.user)==null?void 0:j.email),1)]),e("td",null,[e("span",{class:b(["badge",((T=((D=s.metodo_pago)==null?void 0:D.nombre)||((O=s.metodoPago)==null?void 0:O.nombre)||"")==null?void 0:T.toLowerCase())==="crédito"?"bg-info":"bg-primary"])},d(((L=s.metodo_pago)==null?void 0:L.nombre)||((_=s.metodoPago)==null?void 0:_.nombre)||"N/A"),3)]),e("td",null,[e("span",{class:b(s.tipo_pago==="credito"?"badge bg-warning":"badge bg-success")},d(s.tipo_pago==="credito"?"A Crédito":"Al Contado"),3)]),C.value==="online"?(o(),i("td",vt,[s.direccion_entrega?(o(),i("span",gt,d(s.direccion_entrega),1)):(o(),i("span",pt,"-"))])):v("",!0),e("td",null,[e("strong",null,"Bs. "+d(I(s.total)),1)]),e("td",null,[e("span",{class:b(["badge",s.tipo_pago==="credito"&&s.credito&&s.credito.estado==="pendiente"?"bg-warning text-dark":W(s.estado)])},d(s.tipo_pago==="credito"&&s.credito&&s.credito.estado==="pendiente"?`Crédito (${s.credito.cuotas.filter($=>$.estado==="pagado").length}/${s.credito.cuotas.length})`:s.estado),3)]),e("td",ft,[C.value==="tienda"?(o(),i("div",kt,[m(f(k),{href:n.route("pedidos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles"},{default:r(()=>[...t[23]||(t[23]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),s.estado==="pendiente"?(o(),A(f(k),{key:0,href:n.route("pedidos.edit",s.id),class:"btn btn-outline-warning",title:"Editar pedido"},{default:r(()=>[...t[24]||(t[24]=[e("i",{class:"bi bi-pencil"},null,-1)])]),_:1},8,["href"])):v("",!0),s.estado==="pendiente"?(o(),i("button",{key:1,onClick:$=>H(s),class:"btn btn-outline-success",title:"Confirmar pedido",type:"button"},[...t[25]||(t[25]=[e("i",{class:"bi bi-check-circle"},null,-1)])],8,Ct)):v("",!0),s.estado==="pendiente"?(o(),i("button",{key:2,onClick:$=>B(s),class:"btn btn-outline-danger",title:"Cancelar pedido",type:"button"},[...t[26]||(t[26]=[e("i",{class:"bi bi-x-circle"},null,-1)])],8,yt)):v("",!0)])):(o(),i("div",xt,[m(f(k),{href:n.route("pedidos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles"},{default:r(()=>[...t[27]||(t[27]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),s.estado==="pendiente"?(o(),i("button",{key:0,onClick:$=>B(s),class:"btn btn-outline-danger",title:"Cancelar pedido",type:"button"},[...t[28]||(t[28]=[e("i",{class:"bi bi-x-circle"},null,-1)])],8,wt)):v("",!0),s.estado==="pagado"?(o(),i("button",{key:1,onClick:$=>R(s),class:"btn btn-outline-primary",title:"Marcar como enviado",type:"button"},[...t[29]||(t[29]=[e("i",{class:"bi bi-truck"},null,-1)])],8,$t)):v("",!0)]))])])}),128))])])]),a.pedidos.last_page>1?(o(),i("nav",ht,[e("ul",Pt,[e("li",{class:b(["page-item",{disabled:!a.pedidos.prev_page_url}])},[m(f(k),{class:"page-link",href:a.pedidos.prev_page_url||"#",disabled:!a.pedidos.prev_page_url},{default:r(()=>[...t[30]||(t[30]=[l(" Anterior ",-1)])]),_:1},8,["href","disabled"])],2),(o(!0),i(q,null,z(U.value,s=>{var c;return o(),i("li",{key:s,class:b(["page-item",{active:s===a.pedidos.current_page,disabled:s==="..."}])},[s!=="..."?(o(),A(f(k),{key:0,class:"page-link",href:((c=a.pedidos.links[s])==null?void 0:c.url)||"#"},{default:r(()=>[l(d(s),1)]),_:2},1032,["href"])):(o(),i("span",Et,"..."))],2)}),128)),e("li",{class:b(["page-item",{disabled:!a.pedidos.next_page_url}])},[m(f(k),{class:"page-link",href:a.pedidos.next_page_url||"#",disabled:!a.pedidos.next_page_url},{default:r(()=>[...t[31]||(t[31]=[l(" Siguiente ",-1)])]),_:1},8,["href","disabled"])],2)])])):v("",!0)])])):(o(),i("div",St,[t[32]||(t[32]=e("i",{class:"bi bi-info-circle"},null,-1)),l(" No hay pedidos "+d(a.filtro_estado==="pendiente"?"pendientes":a.filtro_estado==="pagado"?"pagados":a.filtro_estado==="enviado"?"enviados":"anulados")+". ",1)]))]),m(G,{show:N.value,onClose:g,"max-width":"sm"},{title:r(()=>[...t[33]||(t[33]=[l(" Confirmar Pedido ",-1)])]),content:r(()=>{var s;return[e("p",Nt,[t[34]||(t[34]=l(" ¿Está seguro de que desea confirmar el pedido ",-1)),e("strong",null,"#"+d((s=u.value)==null?void 0:s.id),1),t[35]||(t[35]=l("? ",-1))]),t[36]||(t[36]=e("p",{class:"text-muted small mb-0 mt-2"}," Esta acción convertirá el pedido en una venta. ",-1))]}),footer:r(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:g}," Cancelar "),e("button",{type:"button",class:"btn btn-success",onClick:J},[...t[37]||(t[37]=[e("i",{class:"bi bi-check-circle me-2"},null,-1),l(" Confirmar ",-1)])])]),_:1},8,["show"]),m(G,{show:F.value,onClose:g,"max-width":"sm"},{title:r(()=>[...t[38]||(t[38]=[l(" Cancelar Pedido ",-1)])]),content:r(()=>{var s;return[e("p",Ft,[t[39]||(t[39]=l(" ¿Está seguro de que desea cancelar el pedido ",-1)),e("strong",null,"#"+d((s=u.value)==null?void 0:s.id),1),t[40]||(t[40]=l("? ",-1))]),t[41]||(t[41]=e("p",{class:"text-muted small mb-0 mt-2"}," El stock de los productos será devuelto automáticamente. ",-1))]}),footer:r(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:g}," No, volver "),e("button",{type:"button",class:"btn btn-danger",onClick:Q},[...t[42]||(t[42]=[e("i",{class:"bi bi-x-circle me-2"},null,-1),l(" Sí, cancelar pedido ",-1)])])]),_:1},8,["show"]),m(Y,{show:P.value,total:((p=u.value)==null?void 0:p.total)||0,"cuotas-iniciales":3,onClose:t[6]||(t[6]=s=>P.value=!1),onConfirmar:K},null,8,["show","total"])]}),_:1}))}};export{_t as default};
