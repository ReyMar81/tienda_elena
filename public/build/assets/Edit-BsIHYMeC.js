import{r as w,E as B,h as v,g as U,w as A,b as o,e as n,t as a,d as q,j as m,c as d,f as V,o as i,F as g,m as f,q as x,p as E,n as D,a as T,u as L,i as I,N as O}from"./app-9HEqLJnm.js";import{_ as $}from"./AppLayout-DD1QV7aw.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"container py-4"},H={class:"row"},J={class:"col-lg-10 mx-auto"},K={class:"d-flex justify-content-between align-items-center mb-4"},Q={class:"mb-0 text-primary fw-bold"},R={class:"card shadow-sm border-0 mb-4"},W={class:"card-body p-4"},X={class:"row"},Y={class:"col-md-8"},Z=["value"],oo={key:0,class:"mt-2"},eo={class:"text-muted"},to={class:"card shadow-sm border-0 mb-4"},so={class:"card-body p-4"},lo={class:"row mb-4"},ao={class:"col-md-6"},io={class:"table-responsive mb-4",style:{"max-height":"300px","overflow-y":"auto"}},no={class:"table table-hover align-middle"},ro={class:"fw-semibold"},co={key:0,class:"badge bg-danger"},uo={key:1,class:"text-muted"},mo={class:"text-center"},bo=["onClick","disabled"],po={key:0},_o={class:"table-responsive"},vo={class:"table table-bordered table-striped align-middle"},go={class:"fw-semibold"},fo=["onUpdate:modelValue","max"],ho={class:"text-muted"},yo={key:0,class:"badge bg-danger"},wo={key:1},xo={class:"fw-bold text-primary"},ko={class:"text-center"},Co=["onClick"],Po={class:"table-light"},Ao={colspan:"2",class:"fw-bold fs-5 text-primary"},Vo={key:1,class:"alert alert-info"},Eo={class:"card shadow-sm border-0 mb-4"},Fo={class:"card-body p-4"},So={class:"row"},jo={class:"col-md-6"},Mo={class:"col-md-6"},No=["value"],Bo={key:0,class:"alert alert-warning mt-3"},Uo={class:"card shadow-sm border-0"},qo={class:"card-body p-4 text-end"},Do=["disabled"],To={__name:"Edit",props:{pedido:Object,clientes:Array,productos:Array,metodosPago:Array},setup(b){const r=b,l=w({user_id:"",metodo_pago_id:"",tipo_pago:"contado",detalles:[],numero_cuotas:3}),p=w(""),h=w(!1);B(()=>{l.value.user_id=r.pedido.user_id,l.value.metodo_pago_id=r.pedido.metodo_pago_id,l.value.tipo_pago=r.pedido.tipo_pago||"contado",r.pedido.detalles.forEach(s=>{const e=s.producto,t=s.descuento>0?s.descuento/s.precio_unitario*100:0;l.value.detalles.push({producto_id:s.producto_id,nombre:e.nombre,cantidad:s.cantidad,precio_unitario:parseFloat(s.precio_unitario),descuento_porcentaje:t,stock_disponible:e.stock_actual+s.cantidad,subtotal:parseFloat(s.subtotal)})})});const k=v(()=>r.clientes.find(s=>s.id===l.value.user_id)||{}),F=v(()=>{if(!p.value)return r.productos;const s=p.value.toLowerCase();return r.productos.filter(e=>e.nombre.toLowerCase().includes(s)||e.codigo&&e.codigo.toLowerCase().includes(s))}),S=v(()=>l.value.detalles.reduce((s,e)=>s+e.subtotal,0)),C=v(()=>l.value.user_id&&l.value.metodo_pago_id&&l.value.detalles.length>0),j=s=>{var c;if(l.value.detalles.find(P=>P.producto_id===s.id))return alert("Este producto ya está agregado");let t=0;(c=s.promociones)!=null&&c.length&&(t=parseFloat(s.promociones[0].valor_descuento_decimal));const u=s.precio_venta*(1-t/100);l.value.detalles.push({producto_id:s.id,nombre:s.nombre,cantidad:1,precio_unitario:parseFloat(s.precio_venta),descuento_porcentaje:t,stock_disponible:s.stock_actual,subtotal:u}),y()},M=s=>{l.value.detalles.splice(s,1),y()},y=()=>{l.value.detalles.forEach(s=>{const e=s.precio_unitario*(1-s.descuento_porcentaje/100);s.subtotal=e*s.cantidad})},_=s=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(s),N=()=>{if(!C.value)return alert("Complete los campos obligatorios");h.value=!0,O.put(route("pedidos.update",r.pedido.id),l.value,{onFinish:()=>h.value=!1})};return(s,e)=>(i(),U($,{title:"Editar Pedido"},{default:A(()=>[o("div",G,[o("div",H,[o("div",J,[o("div",K,[o("div",null,[o("h2",Q,[e[4]||(e[4]=o("i",{class:"bi bi-pencil-square me-2"},null,-1)),n(" Editar Pedido #"+a(b.pedido.id),1)]),e[5]||(e[5]=o("p",{class:"text-muted"},"Modifica los datos del pedido seleccionado",-1))])]),o("form",{onSubmit:q(N,["prevent"])},[o("div",R,[o("div",W,[e[9]||(e[9]=o("h5",{class:"fw-bold mb-3 text-primary"},[o("i",{class:"bi bi-person-lines-fill me-2"}),n(" 1. Seleccionar Cliente ")],-1)),o("div",X,[o("div",Y,[e[8]||(e[8]=o("label",{class:"form-label fw-semibold"},"Cliente *",-1)),m(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.user_id=t),class:"form-select",required:""},[e[6]||(e[6]=o("option",{value:""},"-- Seleccione un cliente --",-1)),(i(!0),d(g,null,f(b.clientes,t=>(i(),d("option",{key:t.id,value:t.id},a(t.nombre)+" "+a(t.apellidos)+" - CI: "+a(t.ci),9,Z))),128))],512),[[x,l.value.user_id]]),l.value.user_id?(i(),d("div",oo,[o("small",eo,[e[7]||(e[7]=o("i",{class:"bi bi-info-circle me-1"},null,-1)),n(" "+a(k.value.email)+" | "+a(k.value.telefono),1)])])):V("",!0)])])])]),o("div",to,[o("div",so,[e[17]||(e[17]=o("h5",{class:"fw-bold mb-4 text-primary"},[o("i",{class:"bi bi-bag-plus me-2"}),n(" 2. Agregar Productos ")],-1)),o("div",lo,[o("div",ao,[m(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),type:"text",class:"form-control",placeholder:"Buscar producto por nombre o código..."},null,512),[[E,p.value]])])]),o("div",io,[o("table",no,[e[11]||(e[11]=o("thead",{class:"table-light sticky-top"},[o("tr",null,[o("th",null,"Código"),o("th",null,"Producto"),o("th",null,"Categoría"),o("th",null,"Precio"),o("th",null,"Stock"),o("th",null,"Descuento"),o("th",{class:"text-center"},"Acción")])],-1)),o("tbody",null,[(i(!0),d(g,null,f(F.value,t=>{var u,c;return i(),d("tr",{key:t.id},[o("td",null,a(t.codigo),1),o("td",ro,a(t.nombre),1),o("td",null,a(((u=t.categoria)==null?void 0:u.nombre)||"N/A"),1),o("td",null,a(_(t.precio_venta)),1),o("td",null,[o("span",{class:D(t.stock_actual<10?"badge bg-warning":"badge bg-success")},a(t.stock_actual),3)]),o("td",null,[(c=t.promociones)!=null&&c.length?(i(),d("span",co," -"+a(t.promociones[0].valor_descuento_decimal)+"% ",1)):(i(),d("span",uo,"-"))]),o("td",mo,[o("button",{type:"button",onClick:P=>j(t),class:"btn btn-sm btn-primary",disabled:t.stock_actual===0},[...e[10]||(e[10]=[o("i",{class:"bi bi-plus-circle me-1"},null,-1),n(" Agregar ",-1)])],8,bo)])])}),128))])])]),l.value.detalles.length>0?(i(),d("div",po,[e[15]||(e[15]=o("h5",{class:"fw-bold mb-3 text-primary"},[o("i",{class:"bi bi-box-seam me-2"}),n(" Productos Seleccionados ")],-1)),o("div",_o,[o("table",vo,[e[14]||(e[14]=o("thead",{class:"table-dark"},[o("tr",null,[o("th",null,"Producto"),o("th",{width:"150"},"Cantidad"),o("th",null,"Precio Unit."),o("th",null,"Descuento"),o("th",null,"Subtotal"),o("th",{width:"80"},"Acción")])],-1)),o("tbody",null,[(i(!0),d(g,null,f(l.value.detalles,(t,u)=>(i(),d("tr",{key:t.producto_id},[o("td",go,a(t.nombre),1),o("td",null,[m(o("input",{"onUpdate:modelValue":c=>t.cantidad=c,type:"number",min:"1",max:t.stock_disponible,class:"form-control form-control-sm",onInput:y},null,40,fo),[[E,t.cantidad,void 0,{number:!0}]]),o("small",ho,"Máx: "+a(t.stock_disponible),1)]),o("td",null,a(_(t.precio_unitario)),1),o("td",null,[t.descuento_porcentaje>0?(i(),d("span",yo," -"+a(t.descuento_porcentaje)+"% ",1)):(i(),d("span",wo,"-"))]),o("td",xo,a(_(t.subtotal)),1),o("td",ko,[o("button",{type:"button",onClick:c=>M(u),class:"btn btn-sm btn-danger"},[...e[12]||(e[12]=[o("i",{class:"bi bi-trash"},null,-1)])],8,Co)])]))),128))]),o("tfoot",Po,[o("tr",null,[e[13]||(e[13]=o("td",{colspan:"4",class:"text-end fw-bold"},"TOTAL:",-1)),o("td",Ao,a(_(S.value)),1)])])])])])):(i(),d("div",Vo,[...e[16]||(e[16]=[o("i",{class:"bi bi-info-circle me-2"},null,-1),n(" No hay productos seleccionados. Agregue al menos uno. ",-1)])]))])]),o("div",Eo,[o("div",Fo,[e[23]||(e[23]=o("h5",{class:"fw-bold mb-4 text-primary"},[o("i",{class:"bi bi-credit-card me-2"}),n(" 3. Método de Pago ")],-1)),o("div",So,[o("div",jo,[e[19]||(e[19]=o("label",{class:"form-label fw-semibold"},"Tipo de Pago *",-1)),m(o("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.tipo_pago=t),class:"form-select",required:""},[...e[18]||(e[18]=[o("option",{value:"contado"},"Al Contado",-1),o("option",{value:"credito"},"A Crédito",-1)])],512),[[x,l.value.tipo_pago]])]),o("div",Mo,[e[21]||(e[21]=o("label",{class:"form-label fw-semibold"},"Método de Pago *",-1)),m(o("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.metodo_pago_id=t),class:"form-select",required:""},[e[20]||(e[20]=o("option",{value:""},"-- Seleccione método de pago --",-1)),(i(!0),d(g,null,f(b.metodosPago,t=>(i(),d("option",{key:t.id,value:t.id},a(t.nombre),9,No))),128))],512),[[x,l.value.metodo_pago_id]])])]),l.value.tipo_pago==="credito"?(i(),d("div",Bo,[...e[22]||(e[22]=[o("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),o("strong",null,"Pago a Crédito:",-1),n(" El número de cuotas se configurará al confirmar el pedido. ",-1)])])):V("",!0)])]),o("div",Uo,[o("div",qo,[T(L(I),{href:s.route("pedidos.index"),class:"btn btn-secondary"},{default:A(()=>[...e[24]||(e[24]=[o("i",{class:"bi bi-arrow-left me-2"},null,-1),n("Cancelar ",-1)])]),_:1},8,["href"]),o("button",{type:"submit",class:"btn btn-success ms-2",disabled:!C.value||h.value},[...e[25]||(e[25]=[o("i",{class:"bi bi-save me-2"},null,-1),n(" Actualizar Pedido ",-1)])],8,Do)])])],32)])])])]),_:1}))}},$o=z(To,[["__scopeId","data-v-7020a9f4"]]);export{$o as default};
