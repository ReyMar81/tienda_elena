import{r as I,g as m,w as f,b as e,a as v,c as n,f as r,e as s,t,n as g,o as i,F as Q,m as T,u as w,i as y,N as p}from"./app-BM_Csk7S.js";import{_ as M}from"./AppLayout-Aol2IiYi.js";import{_ as R}from"./CreditoModal-CA9nXI4n.js";import{Q as O}from"./QRPayment-BbRC9gJP.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DialogModal-KP0K2W7x.js";import"./Modal-DVp3ZsaT.js";import"./PrimaryButton-DmRnZn5i.js";import"./SecondaryButton-CbdVSPUO.js";const z={class:"container py-4"},L={class:"d-flex justify-content-between align-items-center mb-4"},G={class:"mb-0"},H={class:"card shadow-sm border-0 mb-4"},J={class:"card-body pt-3"},K={class:"row"},W={class:"col-md-6 border-end"},X={class:"table table-borderless mb-0"},Y={class:"badge bg-primary"},Z={key:0},_={class:"col-md-6"},ee={class:"table table-borderless mb-0"},de={key:0,class:"card shadow-sm border-0 mb-4"},oe={class:"card-body"},te={class:"row justify-content-center"},ae={class:"col-md-6"},ie={class:"alert alert-info mt-3"},se={key:0},ne={key:1},le={class:"card shadow-sm border-0 mb-4"},re={class:"card-body pt-4"},ce={class:"table-responsive"},ue={class:"table table-hover align-middle"},be={class:"fw-bold"},me={class:"text-muted"},fe={class:"text-end"},ge={class:"text-center"},pe={class:"text-end"},ve={class:"text-end fw-bold"},we={class:"table-light"},ye={class:"text-end fw-bold fs-5"},Pe={key:1,class:"card shadow-sm border-0 mb-4"},Ce={class:"card-body"},he={class:"d-flex flex-wrap gap-3"},xe={key:0,class:"alert alert-info mt-4"},ke={key:2,class:"card shadow-sm border-0"},qe={class:"card-body"},Ee={__name:"Show",props:{pedido:{type:Object,required:!0},qrCuota:{type:Object,required:!1,default:null}},setup(o){const c=o,u=I(!1),B=a=>new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),b=a=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(a),D=a=>`badge ${{pendiente:"bg-warning",pagado:"bg-success",anulado:"bg-danger"}[a]||"bg-secondary"}`,F=()=>{if(c.pedido.tipo_pago==="credito"){u.value=!0;return}confirm("¿Está seguro de confirmar este pedido?")&&p.patch(route("pedidos.accion",c.pedido.id),{accion:"confirmar"},{onError:d=>alert(Object.values(d).join(", "))})},S=a=>{p.patch(route("pedidos.accion",c.pedido.id),{accion:"confirmar",numero_cuotas:a},{onError:d=>alert(Object.values(d).join(", ")),onFinish:()=>u.value=!1})},V=()=>{confirm("¿Está seguro de que desea cancelar este pedido?")&&p.patch(route("pedidos.accion",c.pedido.id),{accion:"cancelar"},{onError:a=>alert(Object.values(a).join(", "))})},$=()=>{confirm("¿Está seguro de marcar este pedido como enviado?")&&p.patch(route("pedidos.marcar-enviado",c.pedido.id),{},{onError:a=>alert(Object.values(a).join(", ")),onSuccess:()=>alert("Pedido marcado como enviado exitosamente")})};return(a,d)=>(i(),m(M,{title:"Detalle del Pedido"},{default:f(()=>{var P,C,h,x,k,q;return[e("div",z,[e("div",L,[e("div",null,[e("h2",G,[d[1]||(d[1]=e("i",{class:"bi bi-bag me-2"},null,-1)),s(" Detalle del Pedido #"+t(o.pedido.id),1)]),d[2]||(d[2]=e("p",{class:"text-muted"},"Información completa del pedido",-1))])]),e("div",H,[d[13]||(d[13]=e("div",{class:"card-header bg-white border-0 pb-1"},[e("h5",{class:"fw-bold mb-0 text-primary"},[e("i",{class:"bi bi-info-circle me-2"}),s(" Información General del Pedido ")])],-1)),e("div",J,[e("div",K,[e("div",W,[e("table",X,[e("tbody",null,[e("tr",null,[d[3]||(d[3]=e("td",{class:"fw-bold"},"N° Pedido:",-1)),e("td",null,"#"+t(o.pedido.id),1)]),e("tr",null,[d[4]||(d[4]=e("td",{class:"fw-bold"},"Fecha:",-1)),e("td",null,t(B(o.pedido.created_at)),1)]),e("tr",null,[d[5]||(d[5]=e("td",{class:"fw-bold"},"Estado:",-1)),e("td",null,[e("span",{class:g([D(o.pedido.estado),"badge"])},t(o.pedido.estado.toUpperCase()),3)])]),e("tr",null,[d[6]||(d[6]=e("td",{class:"fw-bold"},"Tipo de Pago:",-1)),e("td",null,[e("span",{class:g(o.pedido.tipo_pago==="credito"?"badge bg-info":"badge bg-success")},t(o.pedido.tipo_pago==="credito"?"A Crédito":"Al Contado"),3)])]),e("tr",null,[d[7]||(d[7]=e("td",{class:"fw-bold"},"Método de Pago:",-1)),e("td",null,[e("span",Y,t(((P=o.pedido.metodo_pago)==null?void 0:P.nombre)||((C=o.pedido.metodoPago)==null?void 0:C.nombre)||"N/A"),1)])]),o.pedido.observaciones?(i(),n("tr",Z,[d[8]||(d[8]=e("td",{class:"fw-bold"},"Observaciones:",-1)),e("td",null,t(o.pedido.observaciones),1)])):r("",!0)])])]),e("div",_,[e("table",ee,[e("tbody",null,[e("tr",null,[d[9]||(d[9]=e("td",{class:"fw-bold"},"Cliente:",-1)),e("td",null,t(((h=o.pedido.user)==null?void 0:h.nombre)||"N/A"),1)]),e("tr",null,[d[10]||(d[10]=e("td",{class:"fw-bold"},"Email:",-1)),e("td",null,t(((x=o.pedido.user)==null?void 0:x.email)||"N/A"),1)]),e("tr",null,[d[11]||(d[11]=e("td",{class:"fw-bold"},"Teléfono:",-1)),e("td",null,t(((k=o.pedido.user)==null?void 0:k.telefono)||"N/A"),1)]),e("tr",null,[d[12]||(d[12]=e("td",{class:"fw-bold"},"Dirección:",-1)),e("td",null,t(((q=o.pedido.user)==null?void 0:q.direccion)||"N/A"),1)])])])])])])]),o.pedido.estado==="pendiente"&&(o.qrCuota||o.pedido.pago_facil_qr_image)?(i(),n("div",de,[d[17]||(d[17]=e("div",{class:"card-header bg-warning text-dark border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-qr-code me-2"}),s(" Escanea el QR para Pagar ")])],-1)),e("div",oe,[e("div",te,[e("div",ae,[o.qrCuota?(i(),m(O,{key:0,"qr-image":o.qrCuota.qr_image,"transaction-id":o.qrCuota.transaction_id,monto:o.qrCuota.monto,descripcion:`Pago de la primera cuota del pedido #${o.pedido.numero_venta}`,status:o.qrCuota.status||"pending"},null,8,["qr-image","transaction-id","monto","descripcion","status"])):(i(),m(O,{key:1,"qr-image":o.pedido.pago_facil_qr_image,"transaction-id":o.pedido.pago_facil_transaction_id,monto:o.pedido.total,descripcion:`Pedido #${o.pedido.numero_venta}`,status:o.pedido.pago_facil_status||"pending"},null,8,["qr-image","transaction-id","monto","descripcion","status"]))])]),e("div",ie,[d[14]||(d[14]=e("i",{class:"bi bi-info-circle me-2"},null,-1)),d[15]||(d[15]=e("strong",null,"Instrucciones:",-1)),d[16]||(d[16]=s(" Escanea el código QR con tu app bancaria para completar el pago. ",-1)),o.qrCuota?(i(),n("span",se,"Este QR corresponde a la primera cuota. Una vez pagada, se registrará como cuota pagada en el crédito.")):(i(),n("span",ne,'Una vez confirmado el pago, el pedido pasará automáticamente a estado "Pagado".'))])])])):r("",!0),e("div",le,[d[20]||(d[20]=e("div",{class:"card-header bg-white border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-box-seam me-2"}),s(" Productos del Pedido ")])],-1)),e("div",re,[e("div",ce,[e("table",ue,[d[19]||(d[19]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"Producto"),e("th",null,"Categoría"),e("th",{class:"text-end"},"Precio Unit."),e("th",{class:"text-center"},"Cantidad"),e("th",{class:"text-end"},"Descuento"),e("th",{class:"text-end"},"Subtotal")])],-1)),e("tbody",null,[(i(!0),n(Q,null,T(o.pedido.detalles,l=>{var E,N,j,A;return i(),n("tr",{key:l.id},[e("td",null,[e("div",be,t(((E=l.producto)==null?void 0:E.nombre)||"Producto no disponible"),1),e("small",me,t(((N=l.producto)==null?void 0:N.descripcion)||""),1)]),e("td",null,t(((A=(j=l.producto)==null?void 0:j.categoria)==null?void 0:A.nombre)||"N/A"),1),e("td",fe,t(b(l.precio_unitario)),1),e("td",ge,t(l.cantidad),1),e("td",pe,t(b(l.descuento*l.cantidad)),1),e("td",ve,t(b(l.subtotal)),1)])}),128))]),e("tfoot",we,[e("tr",null,[d[18]||(d[18]=e("td",{colspan:"5",class:"text-end fw-bold"},"TOTAL:",-1)),e("td",ye,t(b(o.pedido.total)),1)])])])])])]),o.pedido.estado==="pendiente"||o.pedido.estado==="pagado"&&o.pedido.origen==="online"?(i(),n("div",Pe,[d[27]||(d[27]=e("div",{class:"card-header bg-white border-0"},[e("h5",{class:"fw-bold mb-0"},[e("i",{class:"bi bi-gear me-2"}),s(" Acciones del Pedido ")])],-1)),e("div",Ce,[e("div",he,[o.pedido.estado==="pendiente"?(i(),n("button",{key:0,onClick:F,class:"btn btn-success"},[...d[21]||(d[21]=[e("i",{class:"bi bi-check-circle me-1"},null,-1),s(" Confirmar Pedido ",-1)])])):r("",!0),o.pedido.estado==="pagado"&&o.pedido.origen==="online"?(i(),n("button",{key:1,onClick:$,class:"btn btn-primary"},[...d[22]||(d[22]=[e("i",{class:"bi bi-truck me-1"},null,-1),s(" Marcar como Enviado ",-1)])])):r("",!0),o.pedido.estado==="pendiente"?(i(),n("button",{key:2,onClick:V,class:"btn btn-danger"},[...d[23]||(d[23]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),s(" Cancelar Pedido ",-1)])])):r("",!0),o.pedido.estado==="pendiente"?(i(),m(w(y),{key:3,href:a.route("pedidos.edit",o.pedido.id),class:"btn btn-warning"},{default:f(()=>[...d[24]||(d[24]=[e("i",{class:"bi bi-pencil me-1"},null,-1),s(" Editar Pedido ",-1)])]),_:1},8,["href"])):r("",!0),v(w(y),{href:a.route("pedidos.index"),class:"btn btn-secondary"},{default:f(()=>[...d[25]||(d[25]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),s(" Volver a Pedidos ",-1)])]),_:1},8,["href"])]),o.pedido.tipo_pago==="credito"?(i(),n("div",xe,[...d[26]||(d[26]=[e("i",{class:"bi bi-info-circle me-2"},null,-1),e("strong",null,"Nota:",-1),s(" Al confirmar este pedido se generará automáticamente un crédito. ",-1)])])):r("",!0)])])):(i(),n("div",ke,[e("div",qe,[e("div",{class:g(o.pedido.estado==="pagado"||o.pedido.estado==="enviado"||o.pedido.estado==="completada"?"alert alert-success":"alert alert-warning")},[e("i",{class:g([o.pedido.estado==="pagado"||o.pedido.estado==="enviado"||o.pedido.estado==="completada"?"bi bi-check-circle":"bi bi-exclamation-triangle","me-2"])},null,2),e("strong",null,t(o.pedido.estado==="pagado"?"Pedido Pagado":o.pedido.estado==="enviado"?"Pedido Enviado":o.pedido.estado==="completada"?"Pedido Confirmado":o.pedido.estado==="anulado"?"Pedido Cancelado":"Pedido Procesado"),1),d[28]||(d[28]=s(" - Este pedido ya fue procesado y no se puede modificar. ",-1))],2),v(w(y),{href:a.route("pedidos.index"),class:"btn btn-secondary"},{default:f(()=>[...d[29]||(d[29]=[e("i",{class:"bi bi-arrow-left me-1"},null,-1),s(" Volver a Pedidos ",-1)])]),_:1},8,["href"])])]))]),v(R,{show:u.value,total:o.pedido.total,"cuotas-iniciales":3,onClose:d[0]||(d[0]=l=>u.value=!1),onConfirmar:S},null,8,["show","total"])]}),_:1}))}},$e=U(Ee,[["__scopeId","data-v-8db009a5"]]);export{$e as default};
