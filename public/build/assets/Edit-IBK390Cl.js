import{Q as L,T as I,r as k,c as a,a as f,u as s,Z as O,w as g,b as o,i as j,e as n,d as A,j as p,f as d,n as b,p as v,o as i,t as m,F as w,m as S,q as R,v as q,N as D}from"./app-9HEqLJnm.js";import{_ as J}from"./AppLayout-DD1QV7aw.js";import{F as Q}from"./FlashNotification-r1BZxJy9.js";import{_ as W}from"./ConfirmationModal-Bq64hp6h.js";import{_ as Z}from"./DialogModal-DAvYmej3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-CRs6EPgD.js";const H={class:"container py-4"},K={class:"row mb-4"},X={class:"col-lg-12"},Y={class:"d-flex justify-content-between align-items-center"},oo={class:"row"},eo={class:"col-lg-8 mx-auto"},so={class:"card"},to={class:"card-body"},ro={class:"row g-3"},ao={class:"col-md-6"},io={key:0,class:"invalid-feedback"},lo={class:"col-md-6"},no={class:"input-group"},co=["value"],mo={key:0,class:"invalid-feedback d-block"},uo={class:"col-md-12"},po={key:0,class:"invalid-feedback"},bo={class:"col-md-4"},vo={class:"input-group"},go={key:0,class:"invalid-feedback d-block"},fo={class:"col-md-4"},_o={class:"input-group"},ko={key:0,class:"invalid-feedback d-block"},yo={class:"col-md-4"},xo={class:"input-group"},Co={key:0,class:"invalid-feedback d-block"},wo={class:"col-md-4"},Vo={key:0,class:"invalid-feedback"},Eo={class:"col-md-4"},Uo={key:0,class:"invalid-feedback"},Po={class:"col-md-4"},So={key:0,class:"invalid-feedback"},ho={class:"col-md-12"},Mo={class:"form-check form-switch"},Bo={key:0,class:"invalid-feedback d-block"},No={class:"col-md-12"},Io={key:0,class:"invalid-feedback"},jo={key:1,class:"mt-3"},Ao={class:"d-flex gap-2 flex-wrap"},Do=["src"],Fo=["onClick"],$o={key:2,class:"mt-3"},To={class:"d-flex gap-2 flex-wrap"},zo=["src"],Go={class:"col-md-12 mt-4"},Lo={class:"d-flex gap-2 justify-content-end"},Oo=["disabled"],Ro={key:0},qo={key:1},Jo={class:"mb-3"},Qo={key:0,class:"invalid-feedback"},Wo={class:"mb-3"},Zo={key:0,class:"invalid-feedback"},Ho=["disabled"],Ko=["disabled"],Xo={key:0},Yo={key:1},ne={__name:"Edit",props:{producto:Object,categorias:Array},setup(V){const c=V,h=L(),t=I({codigo:c.producto.codigo,nombre:c.producto.nombre,precio_compra:c.producto.precio_compra,precio_venta:c.producto.precio_venta,precio_venta_mayorista:c.producto.precio_venta_mayorista,stock_actual:c.producto.stock_actual,stock_minimo:c.producto.stock_minimo,marca:c.producto.marca,categoria_id:c.producto.categoria_id,estado:c.producto.estado,imagen:null}),y=k(c.producto.imagenes||[]),x=k([]),C=k(!1),_=k(null),E=k(!1),l=I({nombre:"",descripcion:""}),M=k([...c.categorias]),F=()=>{l.reset(),l.clearErrors(),E.value=!0},U=()=>{E.value=!1,l.reset()},B=()=>{l.post(route("categorias.store"),{preserveScroll:!0,onSuccess:()=>{D.reload({only:["categorias"],preserveScroll:!0,onSuccess:()=>{var e;M.value=[...h.props.categorias];const u=(e=h.props.flash)==null?void 0:e.categoria;u&&(t.categoria_id=u.id),U()}})}})},$=u=>{const e=Array.from(u.target.files);t.imagen=e,x.value=[],e.forEach(r=>{x.value.push(URL.createObjectURL(r))})},T=u=>{_.value=u,C.value=!0},z=()=>{_.value&&D.delete(route("productos.deleteImage",{producto:c.producto.id,imagen:_.value}),{preserveScroll:!0,onSuccess:()=>{y.value=y.value.filter(u=>u.id!==_.value),C.value=!1,_.value=null}})},N=()=>{C.value=!1,_.value=null},G=()=>{t.transform(u=>({...u,_method:"PUT"})).post(route("productos.update",c.producto.id),{preserveScroll:!0})};return(u,e)=>(i(),a(w,null,[f(s(O),{title:`Editar: ${V.producto.nombre}`},null,8,["title"]),f(J,{title:`Editar: ${V.producto.nombre}`},{default:g(()=>[f(Q),o("div",H,[o("div",K,[o("div",X,[o("div",Y,[e[13]||(e[13]=o("div",null,[o("h2",{class:"mb-0"},"Editar Producto"),o("p",{class:"text-muted"}," Actualiza la información del producto ")],-1)),f(s(j),{href:u.route("productos.index"),class:"btn btn-outline-secondary"},{default:g(()=>[...e[12]||(e[12]=[o("i",{class:"bi bi-arrow-left me-2"},null,-1),n(" Volver ",-1)])]),_:1},8,["href"])])])]),o("div",oo,[o("div",eo,[o("div",so,[o("div",to,[o("form",{onSubmit:A(G,["prevent"])},[o("div",ro,[o("div",ao,[e[14]||(e[14]=o("label",{for:"codigo",class:"form-label"},[n("Código "),o("span",{class:"text-danger"},"*")],-1)),p(o("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s(t).codigo=r),type:"text",class:b(["form-control",{"is-invalid":s(t).errors.codigo}]),id:"codigo"},null,2),[[v,s(t).codigo]]),s(t).errors.codigo?(i(),a("div",io,m(s(t).errors.codigo),1)):d("",!0)]),o("div",lo,[e[17]||(e[17]=o("label",{for:"categoria_id",class:"form-label"},"Categoría",-1)),o("div",no,[p(o("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>s(t).categoria_id=r),class:b(["form-select",{"is-invalid":s(t).errors.categoria_id}]),id:"categoria_id"},[e[15]||(e[15]=o("option",{value:""}," Sin categoría ",-1)),(i(!0),a(w,null,S(M.value,r=>(i(),a("option",{key:r.id,value:r.id},m(r.nombre),9,co))),128))],2),[[R,s(t).categoria_id]]),o("button",{type:"button",class:"btn btn-outline-primary",onClick:F,title:"Crear nueva categoría"},[...e[16]||(e[16]=[o("i",{class:"bi bi-plus-lg"},null,-1)])])]),s(t).errors.categoria_id?(i(),a("div",mo,m(s(t).errors.categoria_id),1)):d("",!0),e[18]||(e[18]=o("small",{class:"text-muted"},"Opcional. Puedes crear una nueva categoría con el botón +",-1))]),o("div",uo,[e[19]||(e[19]=o("label",{for:"nombre",class:"form-label"},[n("Nombre "),o("span",{class:"text-danger"},"*")],-1)),p(o("input",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(t).nombre=r),type:"text",class:b(["form-control",{"is-invalid":s(t).errors.nombre}]),id:"nombre"},null,2),[[v,s(t).nombre]]),s(t).errors.nombre?(i(),a("div",po,m(s(t).errors.nombre),1)):d("",!0)]),o("div",bo,[e[21]||(e[21]=o("label",{for:"precio_compra",class:"form-label"},[n("Precio Compra (Bs) "),o("span",{class:"text-danger"},"*")],-1)),o("div",vo,[e[20]||(e[20]=o("span",{class:"input-group-text"},"Bs.",-1)),p(o("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(t).precio_compra=r),type:"number",step:"0.01",class:b(["form-control",{"is-invalid":s(t).errors.precio_compra}]),id:"precio_compra"},null,2),[[v,s(t).precio_compra]])]),s(t).errors.precio_compra?(i(),a("div",go,m(s(t).errors.precio_compra),1)):d("",!0)]),o("div",fo,[e[23]||(e[23]=o("label",{for:"precio_venta",class:"form-label"},[n("Precio Venta (Bs) "),o("span",{class:"text-danger"},"*")],-1)),o("div",_o,[e[22]||(e[22]=o("span",{class:"input-group-text"},"Bs.",-1)),p(o("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s(t).precio_venta=r),type:"number",step:"0.01",class:b(["form-control",{"is-invalid":s(t).errors.precio_venta}]),id:"precio_venta"},null,2),[[v,s(t).precio_venta]])]),s(t).errors.precio_venta?(i(),a("div",ko,m(s(t).errors.precio_venta),1)):d("",!0)]),o("div",yo,[e[25]||(e[25]=o("label",{for:"precio_venta_mayorista",class:"form-label"},[n("Precio Mayorista (Bs) "),o("span",{class:"text-danger"},"*")],-1)),o("div",xo,[e[24]||(e[24]=o("span",{class:"input-group-text"},"Bs.",-1)),p(o("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(t).precio_venta_mayorista=r),type:"number",step:"0.01",class:b(["form-control",{"is-invalid":s(t).errors.precio_venta_mayorista}]),id:"precio_venta_mayorista"},null,2),[[v,s(t).precio_venta_mayorista]])]),s(t).errors.precio_venta_mayorista?(i(),a("div",Co,m(s(t).errors.precio_venta_mayorista),1)):d("",!0)]),o("div",wo,[e[26]||(e[26]=o("label",{for:"stock_actual",class:"form-label"},[n("Stock Actual "),o("span",{class:"text-danger"},"*")],-1)),p(o("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s(t).stock_actual=r),type:"number",class:b(["form-control",{"is-invalid":s(t).errors.stock_actual}]),id:"stock_actual",min:"0"},null,2),[[v,s(t).stock_actual]]),s(t).errors.stock_actual?(i(),a("div",Vo,m(s(t).errors.stock_actual),1)):d("",!0)]),o("div",Eo,[e[27]||(e[27]=o("label",{for:"stock_minimo",class:"form-label"},[n("Stock Mínimo "),o("span",{class:"text-danger"},"*")],-1)),p(o("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s(t).stock_minimo=r),type:"number",class:b(["form-control",{"is-invalid":s(t).errors.stock_minimo}]),id:"stock_minimo",min:"0"},null,2),[[v,s(t).stock_minimo]]),s(t).errors.stock_minimo?(i(),a("div",Uo,m(s(t).errors.stock_minimo),1)):d("",!0)]),o("div",Po,[e[28]||(e[28]=o("label",{for:"marca",class:"form-label"},"Marca",-1)),p(o("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s(t).marca=r),type:"text",class:b(["form-control",{"is-invalid":s(t).errors.marca}]),id:"marca"},null,2),[[v,s(t).marca]]),s(t).errors.marca?(i(),a("div",So,m(s(t).errors.marca),1)):d("",!0)]),o("div",ho,[o("div",Mo,[p(o("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>s(t).estado=r),class:"form-check-input",type:"checkbox",id:"estado","true-value":!0,"false-value":!1},null,512),[[q,s(t).estado]]),e[29]||(e[29]=o("label",{class:"form-check-label",for:"estado"}," Producto Activo ",-1))]),s(t).errors.estado?(i(),a("div",Bo,m(s(t).errors.estado),1)):d("",!0)]),o("div",No,[e[33]||(e[33]=o("label",{for:"imagen",class:"form-label"},"Agregar Nuevas Imágenes",-1)),o("input",{type:"file",class:b(["form-control",{"is-invalid":s(t).errors.imagen}]),id:"imagen",accept:"image/*",multiple:"",onChange:$},null,34),s(t).errors.imagen?(i(),a("div",Io,m(s(t).errors.imagen),1)):d("",!0),e[34]||(e[34]=o("small",{class:"text-muted"},"Formatos: JPG, PNG, WEBP. Máx: 2MB por imagen. Puedes seleccionar múltiples imágenes",-1)),y.value.length>0?(i(),a("div",jo,[e[31]||(e[31]=o("p",{class:"text-muted mb-2"},[o("small",null,"Imágenes actuales:")],-1)),o("div",Ao,[(i(!0),a(w,null,S(y.value,(r,P)=>(i(),a("div",{key:P,class:"position-relative"},[o("img",{src:`/storage/${r.url}`,alt:"Imagen actual",class:"img-thumbnail",style:{"max-width":"150px","max-height":"150px","object-fit":"cover"}},null,8,Do),o("button",{type:"button",onClick:oe=>T(r.id),class:"btn btn-danger btn-sm position-absolute top-0 end-0 m-1",style:{padding:`0.25rem\r
                                                                0.5rem`,"font-size":"0.75rem"},title:"Eliminar imagen"},[...e[30]||(e[30]=[o("i",{class:"bi bi-x-lg"},null,-1)])],8,Fo)]))),128))])])):d("",!0),x.value.length>0?(i(),a("div",$o,[e[32]||(e[32]=o("p",{class:"text-muted mb-2"},[o("small",null,"Nuevas imágenes a agregar:")],-1)),o("div",To,[(i(!0),a(w,null,S(x.value,(r,P)=>(i(),a("img",{key:P,src:r,alt:"Preview",class:"img-thumbnail",style:{"max-width":"150px","max-height":"150px","object-fit":"cover"}},null,8,zo))),128))])])):d("",!0)]),o("div",Go,[o("div",Lo,[f(s(j),{href:u.route("productos.index"),class:"btn btn-secondary"},{default:g(()=>[...e[35]||(e[35]=[n(" Cancelar ",-1)])]),_:1},8,["href"]),o("button",{type:"submit",class:"btn btn-primary",disabled:s(t).processing},[s(t).processing?(i(),a("span",Ro,[...e[36]||(e[36]=[o("i",{class:"bi bi-hourglass-split me-2"},null,-1),n(" Guardando... ",-1)])])):(i(),a("span",qo,[...e[37]||(e[37]=[o("i",{class:"bi bi-save me-2"},null,-1),n(" Actualizar Producto ",-1)])]))],8,Oo)])])])],32)])])])])]),f(W,{show:C.value,onClose:N,"max-width":"sm"},{title:g(()=>[...e[38]||(e[38]=[n(" Confirmar Eliminación de Imagen ",-1)])]),content:g(()=>[...e[39]||(e[39]=[o("p",{class:"mb-0"}," ¿Está seguro de que desea eliminar esta imagen del producto? ",-1),o("p",{class:"text-muted small mb-0 mt-2"}," Esta acción no se puede deshacer y el archivo será eliminado permanentemente. ",-1)])]),footer:g(()=>[o("button",{type:"button",class:"btn btn-secondary",onClick:N}," Cancelar "),o("button",{type:"button",class:"btn btn-danger",onClick:z},[...e[40]||(e[40]=[o("i",{class:"bi bi-trash-fill me-2"},null,-1),n(" Eliminar Imagen ",-1)])])]),_:1},8,["show"]),f(Z,{show:E.value,onClose:U,"max-width":"sm"},{title:g(()=>[...e[41]||(e[41]=[o("i",{class:"bi bi-folder-plus me-2"},null,-1),n(" Crear Categoría Rápida ",-1)])]),content:g(()=>[o("form",{onSubmit:A(B,["prevent"])},[o("div",Jo,[e[42]||(e[42]=o("label",{for:"categoria_nombre",class:"form-label"},[n("Nombre de la Categoría "),o("span",{class:"text-danger"},"*")],-1)),p(o("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>s(l).nombre=r),type:"text",class:b(["form-control",{"is-invalid":s(l).errors.nombre}]),id:"categoria_nombre",placeholder:"Ej: Electrónica",autofocus:""},null,2),[[v,s(l).nombre]]),s(l).errors.nombre?(i(),a("div",Qo,m(s(l).errors.nombre),1)):d("",!0)]),o("div",Wo,[e[43]||(e[43]=o("label",{for:"categoria_descripcion",class:"form-label"},"Descripción",-1)),p(o("textarea",{"onUpdate:modelValue":e[11]||(e[11]=r=>s(l).descripcion=r),class:b(["form-control",{"is-invalid":s(l).errors.descripcion}]),id:"categoria_descripcion",rows:"3",placeholder:"Breve descripción de la categoría (opcional)"},null,2),[[v,s(l).descripcion]]),s(l).errors.descripcion?(i(),a("div",Zo,m(s(l).errors.descripcion),1)):d("",!0)])],32)]),footer:g(()=>[o("button",{type:"button",class:"btn btn-secondary",onClick:U,disabled:s(l).processing}," Cancelar ",8,Ho),o("button",{type:"button",class:"btn btn-primary",onClick:B,disabled:s(l).processing},[s(l).processing?(i(),a("span",Xo,[...e[44]||(e[44]=[o("i",{class:"bi bi-hourglass-split me-2"},null,-1),n(" Guardando... ",-1)])])):(i(),a("span",Yo,[...e[45]||(e[45]=[o("i",{class:"bi bi-save me-2"},null,-1),n(" Crear Categoría ",-1)])]))],8,Ko)]),_:1},8,["show"])]),_:1},8,["title"])],64))}};export{ne as default};
