import{r as m,h as R,c as n,a as p,u as y,Z,w as a,b as t,g as w,f as d,o,i as k,e as r,j as D,s as J,p as L,F as x,m as j,t as u,n as F,N as S}from"./app-BM_Csk7S.js";import{_ as Q}from"./AppLayout-Aol2IiYi.js";import{F as W}from"./FlashNotification-D_t33ewn.js";import{_ as H}from"./ConfirmationModal-DXXzJLlr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-DVp3ZsaT.js";const X={class:"container py-4"},Y={class:"row mb-4"},tt={class:"col-lg-4 text-end"},et={class:"card mb-4"},st={class:"card-body"},lt={class:"row"},ot={class:"col-lg-6"},nt={class:"input-group"},at={class:"card"},rt={class:"card-body"},it={class:"table-responsive"},ut={class:"table table-hover align-middle"},dt={key:0},ct=["src","alt"],bt={class:"badge bg-secondary"},mt={class:"text-end"},pt={class:"text-center"},gt={class:"text-center"},vt={class:"btn-group btn-group-sm",role:"group","aria-label":"Acciones del producto"},ft=["onClick","disabled"],yt=["onClick"],ht={key:0,class:"mt-4"},kt={class:"pagination justify-content-center"},_t=["innerHTML"],Ct={class:"mb-0"},wt={key:0},xt={class:"mb-2"},St=["max"],Nt={class:"text-muted"},$t=["disabled"],Vt={__name:"Index",props:{productos:Object,filters:Object,rol:String},setup(g){const _=g,C=m(_.filters.search||""),h=m(!1),c=m(null),v=m(!1),i=m(null),b=m(1),N=R(()=>(_.rol||"").toLowerCase()==="cliente");console.log("Rol actual:",_.rol),console.log("Es cliente:",N.value);const $=()=>{S.get(route("productos.index"),{search:C.value},{preserveState:!0,replace:!0})},I=l=>{c.value=l,h.value=!0},O=()=>{c.value&&S.delete(route("productos.destroy",c.value.id),{preserveScroll:!0,onSuccess:()=>{h.value=!1,c.value=null}})},B=()=>{h.value=!1,c.value=null},U=l=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB"}).format(l),z=l=>l.imagenes&&l.imagenes.length>0?`/storage/${l.imagenes[0].url}`:"/images/no-image.png",K=l=>{i.value=l,b.value=1,v.value=!0},q=()=>{i.value&&S.post(route("carritos.store"),{producto_id:i.value.id,cantidad:b.value},{preserveScroll:!0,onSuccess:()=>{v.value=!1,i.value=null}})};return(l,e)=>(o(),n(x,null,[p(y(Z),{title:"Productos"}),p(Q,{title:"Productos"},{default:a(()=>{var A,E;return[p(W),t("div",X,[t("div",Y,[e[5]||(e[5]=t("div",{class:"col-lg-8"},[t("h2",{class:"mb-0"},"Gestión de Productos"),t("p",{class:"text-muted"}," Administra tu catálogo de productos ")],-1)),t("div",tt,[(E=(A=l.$page.props.auth.permissions)==null?void 0:A.productos)!=null&&E.create?(o(),w(y(k),{key:0,href:l.route("productos.create"),class:"btn btn-primary"},{default:a(()=>[...e[4]||(e[4]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),r(" Nuevo Producto ",-1)])]),_:1},8,["href"])):d("",!0)])]),t("div",et,[t("div",st,[t("div",lt,[t("div",ot,[t("div",nt,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),type:"text",class:"form-control",placeholder:"Buscar por nombre o código...",onKeyup:J($,["enter"])},null,544),[[L,C.value]]),t("button",{class:"btn btn-outline-secondary",type:"button",onClick:$},[...e[6]||(e[6]=[t("i",{class:"bi bi-search"},null,-1),r(" Buscar ",-1)])])])])])])]),t("div",at,[t("div",rt,[t("div",it,[t("table",ut,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",{style:{width:"80px"}},"Imagen"),t("th",null,"Código"),t("th",null,"Nombre"),t("th",null,"Categoría"),t("th",{class:"text-end"},"Precio"),t("th",{class:"text-center"},"Stock"),t("th",{class:"text-center",style:{width:"180px"}}," Acciones ")])],-1)),t("tbody",null,[g.productos.data.length===0?(o(),n("tr",dt,[...e[7]||(e[7]=[t("td",{colspan:"7",class:"text-center text-muted py-4"}," No se encontraron productos ",-1)])])):d("",!0),(o(!0),n(x,null,j(g.productos.data,s=>{var f,M,P,T,V;return o(),n("tr",{key:s.id},[t("td",null,[t("img",{src:z(s),alt:s.nombre,class:"img-thumbnail",style:{width:"60px",height:"60px","object-fit":"cover"},loading:"lazy"},null,8,ct)]),t("td",null,[t("code",null,u(s.codigo),1)]),t("td",null,[t("strong",null,u(s.nombre),1)]),t("td",null,[t("span",bt,u(((f=s.categoria)==null?void 0:f.nombre)||"Sin categoría"),1)]),t("td",mt,[t("strong",null,u(U(s.precio_venta)),1)]),t("td",pt,[t("span",{class:F(["badge",s.stock_actual>s.stock_minimo?"bg-success":s.stock_actual>0?"bg-warning":"bg-danger"])},u(s.stock_actual),3)]),t("td",gt,[t("div",vt,[p(y(k),{href:l.route("productos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles del producto"},{default:a(()=>[...e[8]||(e[8]=[t("i",{class:"bi bi-eye-fill"},null,-1)])]),_:1},8,["href"]),N.value?(o(),n("button",{key:0,onClick:G=>K(s),class:"btn btn-outline-success",title:"Agregar al carrito",disabled:s.stock_actual===0},[...e[9]||(e[9]=[t("i",{class:"bi bi-cart-plus"},null,-1)])],8,ft)):d("",!0),(P=(M=l.$page.props.auth.permissions)==null?void 0:M.productos)!=null&&P.update?(o(),w(y(k),{key:1,href:l.route("productos.edit",s.id),class:"btn btn-outline-warning",title:"Editar producto"},{default:a(()=>[...e[10]||(e[10]=[t("i",{class:"bi bi-pencil-fill"},null,-1)])]),_:1},8,["href"])):d("",!0),(V=(T=l.$page.props.auth.permissions)==null?void 0:T.productos)!=null&&V.delete?(o(),n("button",{key:2,onClick:G=>I(s),class:"btn btn-outline-danger",title:"Eliminar producto"},[...e[11]||(e[11]=[t("i",{class:"bi bi-trash-fill"},null,-1)])],8,yt)):d("",!0)])])])}),128))])])]),g.productos.links.length>3?(o(),n("div",ht,[t("nav",null,[t("ul",kt,[(o(!0),n(x,null,j(g.productos.links,(s,f)=>(o(),n("li",{key:f,class:F(["page-item",{active:s.active,disabled:!s.url}])},[s.url?(o(),w(y(k),{key:0,href:s.url,class:"page-link",innerHTML:s.label,"preserve-state":""},null,8,["href","innerHTML"])):(o(),n("span",{key:1,class:"page-link",innerHTML:s.label},null,8,_t))],2))),128))])])])):d("",!0)])])]),p(H,{show:h.value,onClose:B,"max-width":"sm"},{title:a(()=>[...e[13]||(e[13]=[r(" Confirmar Eliminación ",-1)])]),content:a(()=>{var s;return[t("p",Ct,[e[14]||(e[14]=r(" ¿Está seguro de que desea eliminar el producto ",-1)),t("strong",null,u((s=c.value)==null?void 0:s.nombre),1),e[15]||(e[15]=r("? ",-1))]),e[16]||(e[16]=t("p",{class:"text-muted small mb-0 mt-2"}," Esta acción no se puede deshacer. ",-1))]}),footer:a(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:B}," Cancelar "),t("button",{type:"button",class:"btn btn-danger",onClick:O},[...e[17]||(e[17]=[t("i",{class:"bi bi-trash-fill me-2"},null,-1),r(" Eliminar ",-1)])])]),_:1},8,["show"]),p(H,{show:v.value,onClose:e[3]||(e[3]=s=>v.value=!1),"max-width":"sm"},{title:a(()=>[...e[18]||(e[18]=[r("Agregar al Carrito",-1)])]),content:a(()=>[i.value?(o(),n("div",wt,[t("p",xt,[e[19]||(e[19]=r("¿Cuántas unidades de ",-1)),t("strong",null,u(i.value.nombre),1),e[20]||(e[20]=r(" deseas agregar?",-1))]),D(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),min:"1",max:i.value.stock_actual,class:"form-control w-50"},null,8,St),[[L,b.value]]),t("small",Nt,"Stock disponible: "+u(i.value.stock_actual),1)])):d("",!0)]),footer:a(()=>{var s;return[t("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=f=>v.value=!1)},"Cancelar"),t("button",{type:"button",class:"btn btn-primary",onClick:q,disabled:b.value<1||b.value>(((s=i.value)==null?void 0:s.stock_actual)||1)},[...e[21]||(e[21]=[t("i",{class:"bi bi-cart-plus me-2"},null,-1),r("Agregar ",-1)])],8,$t)]}),_:1},8,["show"])]}),_:1})],64))}};export{Vt as default};
