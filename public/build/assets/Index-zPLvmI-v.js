import{r as g,h as E,c as a,a as C,f as m,w as h,b as e,e as d,d as H,j as f,p as S,q as I,o,F as V,m as F,t as i,u as M,i as w,n as U,g as J,N as A}from"./app-9HEqLJnm.js";import{_ as K}from"./AppLayout-DD1QV7aw.js";import{F as X}from"./FlashNotification-r1BZxJy9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"container py-4"},Z={class:"card mb-4"},ee={class:"card-body"},te={class:"col-md-4"},se={class:"col-md-3"},le={class:"card"},oe={class:"card-body"},ae={class:"table-responsive"},ne={class:"table table-hover align-middle"},ie={key:0},de={class:"text-end"},re={class:"text-center"},ue={class:"badge bg-info"},ce={class:"text-end text-success"},be={class:"text-end text-danger"},ve={class:"text-center"},me={key:0,class:"badge bg-danger"},pe={key:1,class:"text-muted"},ge={class:"text-center"},fe={class:"text-center"},ye={class:"btn-group btn-group-sm"},_e=["onClick"],xe={key:0,class:"mt-4"},ke={class:"pagination justify-content-center"},Ce={key:1,class:"page-link"},he={key:0,class:"modal fade",tabindex:"-1"},Pe={class:"modal-dialog modal-dialog-centered"},Se={class:"modal-content"},Ve={class:"modal-body"},Me={key:0,class:"mb-4"},we={key:0,class:"badge bg-info ms-2"},Ne={class:"mb-3"},Be=["value"],Fe={class:"mb-3"},Ue={class:"mb-3"},Re={key:1,class:"text-center"},De={class:"modal-footer"},Ie=["disabled"],Oe={key:0,class:"modal fade show d-block",tabindex:"-1",style:{background:"rgba(0,0,0,0.3)"}},Qe={class:"modal-dialog"},qe={class:"modal-content"},Te={class:"modal-body"},je={class:"mb-3"},Ee=["value"],Ae={key:0},Le={class:"mb-3"},$e=["max"],ze={class:"mb-3"},We={class:"modal-footer"},Ge=["disabled"],He=["disabled"],Je={key:0,class:"spinner-border spinner-border-sm me-2"},et={__name:"Index",props:{creditos:Object,filtros:Object},setup(c){var T,j;const N=c,_=g({search:((T=N.filtros)==null?void 0:T.search)||"",estado:((j=N.filtros)==null?void 0:j.estado)||""}),p=n=>new Intl.NumberFormat("es-BO",{style:"currency",currency:"BOB",minimumFractionDigits:2}).format(n),L=n=>({pendiente:"badge bg-warning",pagado:"badge bg-success",vencido:"badge bg-danger"})[n]||"badge bg-secondary",$=n=>{var t;return((t=n.cuotas)==null?void 0:t.filter(l=>l.estado==="pagado").length)||0},O=()=>{A.get(route("mis-creditos.index"),_.value,{preserveState:!0,preserveScroll:!0})},z=()=>{_.value={search:"",estado:""},O()},W=E(()=>{const n=N.creditos.current_page,t=N.creditos.last_page,l=2,s=[],r=[];for(let D=Math.max(2,n-l);D<=Math.min(t-1,n+l);D++)s.push(D);return n-l>2?r.push(1,"..."):r.push(1),r.push(...s),n+l<t-1?r.push("...",t):t>1&&r.push(t),r}),B=g(!1),b=g(null),v=g(null),u=g(0),x=g(new Date().toISOString().slice(0,10)),k=g(""),y=g(!1),G=n=>{b.value=n,v.value=null,k.value="",u.value=0,x.value=new Date().toISOString().slice(0,10),B.value=!0},P=()=>{B.value=!1,b.value=null,v.value=null,k.value="",u.value=0},R=E(()=>{var n;return b.value?((n=b.value.cuotas)==null?void 0:n.filter(t=>t.estado!=="pagado"))||[]:[]}),Q=n=>{const t=R.value.find(l=>l.id===parseInt(n));v.value=t,u.value=t?t.monto_pendiente:0},q=()=>{!v.value||!u.value||u.value<.01||(y.value=!0,A.post(route("mis-creditos.registrar-pago"),{cuota_id:v.value.id,monto:u.value,fecha:x.value},{preserveScroll:!0,onSuccess:()=>{P()},onFinish:()=>{y.value=!1}}))};return(n,t)=>(o(),a(V,null,[C(K,{title:"Mis Créditos"},{default:h(()=>{var l;return[C(X),e("div",Y,[t[36]||(t[36]=e("div",{class:"row mb-4"},[e("div",{class:"col-lg-8"},[e("h2",{class:"mb-0"},[e("i",{class:"bi bi-credit-card me-2"}),d("Mis Créditos ")]),e("p",{class:"text-muted"}," Consulta y gestiona tus créditos personales ")])],-1)),e("div",Z,[e("div",ee,[e("form",{onSubmit:H(O,["prevent"]),class:"row g-3"},[e("div",te,[t[10]||(t[10]=e("label",{class:"form-label"},"Buscar",-1)),f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>_.value.search=s),type:"text",class:"form-control",placeholder:"N° Venta..."},null,512),[[S,_.value.search]])]),e("div",se,[t[12]||(t[12]=e("label",{class:"form-label"},"Estado",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value.estado=s),class:"form-select"},[...t[11]||(t[11]=[e("option",{value:""},"Todos",-1),e("option",{value:"pendiente"},"Pendiente",-1),e("option",{value:"pagado"},"Pagado",-1),e("option",{value:"vencido"},"Vencido",-1)])],512),[[I,_.value.estado]])]),e("div",{class:"col-md-3 d-flex align-items-end"},[t[14]||(t[14]=e("button",{type:"submit",class:"btn btn-primary me-2"},[e("i",{class:"bi bi-search"}),d(" Buscar ")],-1)),e("button",{type:"button",onClick:z,class:"btn btn-secondary"},[...t[13]||(t[13]=[e("i",{class:"bi bi-x-circle"},null,-1),d(" Limpiar ",-1)])])])],32)])]),e("div",le,[e("div",oe,[e("div",ae,[e("table",ne,[t[18]||(t[18]=e("thead",{class:"table-light"},[e("tr",null,[e("th",null,"N° Crédito"),e("th",null,"Venta"),e("th",{class:"text-end"},"Monto Total"),e("th",{class:"text-center"},"Cuotas"),e("th",{class:"text-end"},"Pagado"),e("th",{class:"text-end"},"Pendiente"),e("th",{class:"text-center"},"Mora"),e("th",{class:"text-center"},"Estado"),e("th",{class:"text-center"},"Acciones")])],-1)),e("tbody",null,[c.creditos.data.length===0?(o(),a("tr",ie,[...t[15]||(t[15]=[e("td",{colspan:"9",class:"text-center text-muted py-4"},[e("i",{class:"bi bi-inbox fs-1 d-block mb-2"}),d(" No se encontraron créditos ")],-1)])])):m("",!0),(o(!0),a(V,null,F(c.creditos.data,s=>(o(),a("tr",{key:s.id},[e("td",null,[e("strong",null,"#"+i(s.id),1)]),e("td",null,[C(M(w),{href:n.route("ventas.show",s.venta_id),class:"text-primary"},{default:h(()=>{var r;return[d(i((r=s.venta)==null?void 0:r.numero_venta),1)]}),_:2},1032,["href"])]),e("td",de,i(p(s.monto_credito)),1),e("td",re,[e("span",ue,i($(s))+"/"+i(s.cuotas_total),1)]),e("td",ce,i(p(s.monto_pagado)),1),e("td",be,i(p(s.monto_pendiente)),1),e("td",ve,[s.dias_mora>0?(o(),a("span",me,i(s.dias_mora)+" días ",1)):(o(),a("span",pe,"-"))]),e("td",ge,[e("span",{class:U(L(s.estado))},i(s.estado.toUpperCase()),3)]),e("td",fe,[e("div",ye,[C(M(w),{href:n.route("mis-creditos.show",s.id),class:"btn btn-outline-info",title:"Ver detalles"},{default:h(()=>[...t[16]||(t[16]=[e("i",{class:"bi bi-eye"},null,-1)])]),_:1},8,["href"]),e("button",{class:"btn btn-outline-success",onClick:r=>G(s),title:"Pagar por QR"},[...t[17]||(t[17]=[e("i",{class:"bi bi-qr-code"},null,-1)])],8,_e)])])]))),128))])])]),c.creditos.last_page>1?(o(),a("div",xe,[e("nav",null,[e("ul",ke,[e("li",{class:U(["page-item",{disabled:!c.creditos.prev_page_url}])},[C(M(w),{class:"page-link",href:c.creditos.prev_page_url||"#","preserve-state":""},{default:h(()=>[...t[19]||(t[19]=[d(" Anterior ",-1)])]),_:1},8,["href"])],2),(o(!0),a(V,null,F(W.value,s=>{var r;return o(),a("li",{key:s,class:U(["page-item",{active:s===c.creditos.current_page}])},[s!=="..."?(o(),J(M(w),{key:0,class:"page-link",href:((r=c.creditos.links[s])==null?void 0:r.url)||"#","preserve-state":""},{default:h(()=>[d(i(s),1)]),_:2},1032,["href"])):(o(),a("span",Ce,"..."))],2)}),128)),e("li",{class:U(["page-item",{disabled:!c.creditos.next_page_url}])},[C(M(w),{class:"page-link",href:c.creditos.next_page_url||"#","preserve-state":""},{default:h(()=>[...t[20]||(t[20]=[d(" Siguiente ",-1)])]),_:1},8,["href"])],2)])])])):m("",!0)])]),B.value?(o(),a("div",he,[e("div",Pe,[e("div",Se,[e("div",{class:"modal-header"},[t[21]||(t[21]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-qr-code me-2"}),d("Registrar Pago por QR ")],-1)),e("button",{type:"button",class:"btn-close",onClick:P,"aria-label":"Close"})]),e("div",Ve,[b.value?(o(),a("div",Me,[e("h6",null,[d(" Crédito #"+i(b.value.id)+" ",1),v.value?(o(),a("span",we," Cuota #"+i(v.value.numero_cuota),1)):m("",!0)]),e("p",null,[t[22]||(t[22]=e("strong",null,"Venta:",-1)),d(" "+i((l=b.value.venta)==null?void 0:l.numero_venta),1),t[23]||(t[23]=e("br",null,null,-1)),t[24]||(t[24]=e("strong",null,"Monto Total:",-1)),d(" "+i(p(b.value.monto_credito)),1),t[25]||(t[25]=e("br",null,null,-1)),t[26]||(t[26]=e("strong",null,"Pagado:",-1)),d(" "+i(p(b.value.monto_pagado)),1),t[27]||(t[27]=e("br",null,null,-1)),t[28]||(t[28]=e("strong",null,"Pendiente:",-1)),d(" "+i(p(b.value.monto_pendiente)),1)])])):m("",!0),e("div",Ne,[t[30]||(t[30]=e("label",{class:"form-label"},"Seleccionar Cuota",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>k.value=s),class:"form-select",onChange:t[3]||(t[3]=s=>Q(s.target.value))},[t[29]||(t[29]=e("option",{value:""},"Seleccione una cuota",-1)),(o(!0),a(V,null,F(R.value,s=>(o(),a("option",{key:s.id,value:s.id}," Cuota #"+i(s.numero_cuota)+" - "+i(p(s.monto_pendiente)),9,Be))),128))],544),[[I,k.value]])]),e("div",Fe,[t[31]||(t[31]=e("label",{class:"form-label"},"Monto a Pagar",-1)),f(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>u.value=s),type:"number",class:"form-control",placeholder:"Ingrese el monto",min:"0.01",step:"0.01"},null,512),[[S,u.value,void 0,{number:!0}]])]),e("div",Ue,[t[32]||(t[32]=e("label",{class:"form-label"},"Fecha de Pago",-1)),f(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>x.value=s),type:"date",class:"form-control"},null,512),[[S,x.value]])]),y.value?(o(),a("div",Re,[...t[33]||(t[33]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Cargando...")],-1)])])):m("",!0)]),e("div",De,[e("button",{type:"button",class:"btn btn-secondary",onClick:P},[...t[34]||(t[34]=[e("i",{class:"bi bi-x-circle"},null,-1),d(" Cancelar ",-1)])]),e("button",{type:"button",class:"btn btn-primary",onClick:q,disabled:y.value},[...t[35]||(t[35]=[e("i",{class:"bi bi-check-circle"},null,-1),d(" Registrar Pago ",-1)])],8,Ie)])])])])):m("",!0)])]}),_:1}),B.value?(o(),a("div",Oe,[e("div",Qe,[e("div",qe,[e("div",{class:"modal-header"},[t[37]||(t[37]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-qr-code me-2"}),d("Pagar cuota por QR")],-1)),e("button",{type:"button",class:"btn-close",onClick:P})]),e("div",Te,[e("div",je,[t[39]||(t[39]=e("label",{class:"form-label"},"Seleccionar cuota",-1)),f(e("select",{class:"form-select","onUpdate:modelValue":t[6]||(t[6]=l=>k.value=l),onChange:t[7]||(t[7]=l=>Q(l.target.value))},[t[38]||(t[38]=e("option",{value:""},"-- Seleccione una cuota --",-1)),(o(!0),a(V,null,F(R.value,l=>(o(),a("option",{key:l.id,value:l.id}," Cuota #"+i(l.numero_cuota)+" - Pendiente: "+i(p(l.monto_pendiente)),9,Ee))),128))],544),[[I,k.value]])]),v.value?(o(),a("div",Ae,[e("div",Le,[t[40]||(t[40]=e("label",{class:"form-label"},"Monto a pagar",-1)),f(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[8]||(t[8]=l=>u.value=l),max:v.value.monto_pendiente,min:"0.01",step:"0.01"},null,8,$e),[[S,u.value]])]),e("div",ze,[t[41]||(t[41]=e("label",{class:"form-label"},"Fecha de pago",-1)),f(e("input",{type:"date",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=l=>x.value=l)},null,512),[[S,x.value]])]),t[42]||(t[42]=e("div",{class:"mb-3"},[e("label",{class:"form-label"},"Método de pago"),e("input",{type:"text",class:"form-control",value:"QR",disabled:""})],-1))])):m("",!0)]),e("div",We,[e("button",{type:"button",class:"btn btn-secondary",onClick:P,disabled:y.value},"Cancelar",8,Ge),e("button",{type:"button",class:"btn btn-success",disabled:!v.value||!u.value||u.value<.01||y.value,onClick:q},[y.value?(o(),a("span",Je)):m("",!0),t[43]||(t[43]=e("i",{class:"bi bi-qr-code me-2"},null,-1)),t[44]||(t[44]=d("Pagar por QR ",-1))],8,He)])])])])):m("",!0)],64))}};export{et as default};
